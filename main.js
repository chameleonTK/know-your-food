!function(a){function b(a){if(a in l.style)return a;var b=["Moz","Webkit","O","ms"],c=a.charAt(0).toUpperCase()+a.substr(1);if(a in l.style)return a;for(var d=0;d<b.length;++d){var e=b[d]+c;if(e in l.style)return e}}function c(){return l.style[m.transform]="",l.style[m.transform]="rotateY(90deg)",""!==l.style[m.transform]}function d(a){return"string"==typeof a&&this.parse(a),this}function e(a,b,c){b===!0?a.queue(c):b?a.queue(b,c):c()}function f(b){var c=[];return a.each(b,function(b){b=a.camelCase(b),b=a.transit.propertyMap[b]||a.cssProps[b]||b,b=i(b),-1===a.inArray(b,c)&&c.push(b)}),c}function g(b,c,d,e){var g=f(b);a.cssEase[d]&&(d=a.cssEase[d]);var h=""+k(c)+" "+d;parseInt(e,10)>0&&(h+=" "+k(e));var i=[];return a.each(g,function(a,b){i.push(b+" "+h)}),i.join(", ")}function h(b,c){c||(a.cssNumber[b]=!0),a.transit.propertyMap[b]=m.transform,a.cssHooks[b]={get:function(c){var d=a(c).css("transit:transform");return d.get(b)},set:function(c,d){var e=a(c).css("transit:transform");e.setFromString(b,d),a(c).css({"transit:transform":e})}}}function i(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function j(a,b){return"string"!=typeof a||a.match(/^[\-0-9\.]+$/)?""+a+b:a}function k(b){var c=b;return a.fx.speeds[c]&&(c=a.fx.speeds[c]),j(c,"ms")}a.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var l=document.createElement("div"),m={},n=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;m.transition=b("transition"),m.transitionDelay=b("transitionDelay"),m.transform=b("transform"),m.transformOrigin=b("transformOrigin"),m.transform3d=c();var o={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},p=m.transitionEnd=o[m.transition]||null;for(var q in m)m.hasOwnProperty(q)&&"undefined"==typeof a.support[q]&&(a.support[q]=m[q]);l=null,a.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},a.cssHooks["transit:transform"]={get:function(b){return a(b).data("transform")||new d},set:function(b,c){var e=c;e instanceof d||(e=new d(e)),b.style[m.transform]="WebkitTransform"!==m.transform||n?e.toString():e.toString(!0),a(b).data("transform",e)}},a.cssHooks.transform={set:a.cssHooks["transit:transform"].set},a.fn.jquery<"1.8"&&(a.cssHooks.transformOrigin={get:function(a){return a.style[m.transformOrigin]},set:function(a,b){a.style[m.transformOrigin]=b}},a.cssHooks.transition={get:function(a){return a.style[m.transition]},set:function(a,b){a.style[m.transition]=b}}),h("scale"),h("translate"),h("rotate"),h("rotateX"),h("rotateY"),h("rotate3d"),h("perspective"),h("skewX"),h("skewY"),h("x",!0),h("y",!0),d.prototype={setFromString:function(a,b){var c="string"==typeof b?b.split(","):b.constructor===Array?b:[b];c.unshift(a),d.prototype.set.apply(this,c)},set:function(a){var b=Array.prototype.slice.apply(arguments,[1]);this.setter[a]?this.setter[a].apply(this,b):this[a]=b.join(",")},get:function(a){return this.getter[a]?this.getter[a].apply(this):this[a]||0},setter:{rotate:function(a){this.rotate=j(a,"deg")},rotateX:function(a){this.rotateX=j(a,"deg")},rotateY:function(a){this.rotateY=j(a,"deg")},scale:function(a,b){void 0===b&&(b=a),this.scale=a+","+b},skewX:function(a){this.skewX=j(a,"deg")},skewY:function(a){this.skewY=j(a,"deg")},perspective:function(a){this.perspective=j(a,"px")},x:function(a){this.set("translate",a,null)},y:function(a){this.set("translate",null,a)},translate:function(a,b){void 0===this._translateX&&(this._translateX=0),void 0===this._translateY&&(this._translateY=0),null!==a&&void 0!==a&&(this._translateX=j(a,"px")),null!==b&&void 0!==b&&(this._translateY=j(b,"px")),this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var a=(this.scale||"1,1").split(",");return a[0]&&(a[0]=parseFloat(a[0])),a[1]&&(a[1]=parseFloat(a[1])),a[0]===a[1]?a[0]:a},rotate3d:function(){for(var a=(this.rotate3d||"0,0,0,0deg").split(","),b=0;3>=b;++b)a[b]&&(a[b]=parseFloat(a[b]));return a[3]&&(a[3]=j(a[3],"deg")),a}},parse:function(a){var b=this;a.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(a,c,d){b.setFromString(c,d)})},toString:function(a){var b=[];for(var c in this)if(this.hasOwnProperty(c)){if(!m.transform3d&&("rotateX"===c||"rotateY"===c||"perspective"===c||"transformOrigin"===c))continue;"_"!==c[0]&&(a&&"scale"===c?b.push(c+"3d("+this[c]+",1)"):a&&"translate"===c?b.push(c+"3d("+this[c]+",0)"):b.push(c+"("+this[c]+")"))}return b.join(" ")}},a.fn.transition=a.fn.transit=function(b,c,d,f){var h=this,i=0,j=!0;"function"==typeof c&&(f=c,c=void 0),"function"==typeof d&&(f=d,d=void 0),"undefined"!=typeof b.easing&&(d=b.easing,delete b.easing),"undefined"!=typeof b.duration&&(c=b.duration,delete b.duration),"undefined"!=typeof b.complete&&(f=b.complete,delete b.complete),"undefined"!=typeof b.queue&&(j=b.queue,delete b.queue),"undefined"!=typeof b.delay&&(i=b.delay,delete b.delay),"undefined"==typeof c&&(c=a.fx.speeds._default),"undefined"==typeof d&&(d=a.cssEase._default),c=k(c);var l=g(b,c,d,i),n=a.transit.enabled&&m.transition,o=n?parseInt(c,10)+parseInt(i,10):0;if(0===o){var q=function(a){h.css(b),f&&f.apply(h),a&&a()};return e(h,j,q),h}var r={},s=function(c){var d=!1,e=function(){d&&h.unbind(p,e),o>0&&h.each(function(){this.style[m.transition]=r[this]||null}),"function"==typeof f&&f.apply(h),"function"==typeof c&&c()};o>0&&p&&a.transit.useTransitionEnd?(d=!0,h.bind(p,e)):window.setTimeout(e,o),h.each(function(){o>0&&(this.style[m.transition]=l),a(this).css(b)})},t=function(a){this.offsetWidth,s(a)};return e(h,j,t),this},a.transit.getTransitionValue=g}(jQuery),function(a){function b(a){return a}function c(a,b){for(var c=0,d=b.length,e=new Array(d);d>c;++c)e[c]=a[b[c]];return e}function d(a){function b(b,c,d,e){for(;e>d;){var f=d+e>>>1;a(b[f])<c?d=f+1:e=f}return d}function c(b,c,d,e){for(;e>d;){var f=d+e>>>1;c<a(b[f])?e=f:d=f+1}return d}return c.right=c,c.left=b,c}function e(a){function b(a,b,c){for(var e=c-b,f=(e>>>1)+1;--f>0;)d(a,f,e,b);return a}function c(a,b,c){for(var e,f=c-b;--f>0;)e=a[b],a[b]=a[b+f],a[b+f]=e,d(a,1,f,b);return a}function d(b,c,d,e){for(var f,g=b[--e+c],h=a(g);(f=c<<1)<=d&&(d>f&&a(b[e+f])>a(b[e+f+1])&&f++,!(h<=a(b[e+f])));)b[e+c]=b[e+f],c=f;b[e+c]=g}return b.sort=c,b}function f(a){function b(b,d,e,f){var g,h,i,j,k=new Array(f=Math.min(e-d,f));for(h=0;f>h;++h)k[h]=b[d++];if(c(k,0,f),e>d){g=a(k[0]);do(i=a(j=b[d])>g)&&(k[0]=j,g=a(c(k,0,f)[0]));while(++d<e)}return k}var c=e(a);return b}function g(a){function b(b,c,d){for(var e=c+1;d>e;++e){for(var f=e,g=b[e],h=a(g);f>c&&a(b[f-1])>h;--f)b[f]=b[f-1];b[f]=g}return b}return b}function h(a){function b(a,b,e){return(B>e-b?d:c)(a,b,e)}function c(c,d,e){var f,g=(e-d)/6|0,h=d+g,i=e-1-g,j=d+e-1>>1,k=j-g,l=j+g,m=c[h],n=a(m),o=c[k],p=a(o),q=c[j],r=a(q),s=c[l],t=a(s),u=c[i],v=a(u);n>p&&(f=m,m=o,o=f,f=n,n=p,p=f),t>v&&(f=s,s=u,u=f,f=t,t=v,v=f),n>r&&(f=m,m=q,q=f,f=n,n=r,r=f),p>r&&(f=o,o=q,q=f,f=p,p=r,r=f),n>t&&(f=m,m=s,s=f,f=n,n=t,t=f),r>t&&(f=q,q=s,s=f,f=r,r=t,t=f),p>v&&(f=o,o=u,u=f,f=p,p=v,v=f),p>r&&(f=o,o=q,q=f,f=p,p=r,r=f),t>v&&(f=s,s=u,u=f,f=t,t=v,v=f);var w=o,x=p,y=s,z=t;c[h]=m,c[k]=c[d],c[j]=q,c[l]=c[e-1],c[i]=u;var A=d+1,B=e-2,C=z>=x&&x>=z;if(C)for(var D=A;B>=D;++D){var E=c[D],F=a(E);if(x>F)D!==A&&(c[D]=c[A],c[A]=E),++A;else if(F>x)for(;;){var G=a(c[B]);{if(!(G>x)){if(x>G){c[D]=c[A],c[A++]=c[B],c[B--]=E;break}c[D]=c[B],c[B--]=E;break}B--}}}else for(var D=A;B>=D;D++){var E=c[D],F=a(E);if(x>F)D!==A&&(c[D]=c[A],c[A]=E),++A;else if(F>z)for(;;){var G=a(c[B]);{if(!(G>z)){x>G?(c[D]=c[A],c[A++]=c[B],c[B--]=E):(c[D]=c[B],c[B--]=E);break}if(B--,D>B)break}}}if(c[d]=c[A-1],c[A-1]=w,c[e-1]=c[B+1],c[B+1]=y,b(c,d,A-1),b(c,B+2,e),C)return c;if(h>A&&B>i){for(var H,G;(H=a(c[A]))<=x&&H>=x;)++A;for(;(G=a(c[B]))<=z&&G>=z;)--B;for(var D=A;B>=D;D++){var E=c[D],F=a(E);if(x>=F&&F>=x)D!==A&&(c[D]=c[A],c[A]=E),A++;else if(z>=F&&F>=z)for(;;){var G=a(c[B]);{if(!(z>=G&&G>=z)){x>G?(c[D]=c[A],c[A++]=c[B],c[B--]=E):(c[D]=c[B],c[B--]=E);break}if(B--,D>B)break}}}}return b(c,A,B+1)}var d=g(a);return b}function i(a){return new Array(a)}function j(a,b){return function(c){var d=c.length;return[a.left(c,b,0,d),a.right(c,b,0,d)]}}function k(a,b){var c=b[0],d=b[1];return function(b){var e=b.length;return[a.left(b,c,0,e),a.left(b,d,0,e)]}}function l(a){return[0,a.length]}function m(){return null}function n(){return 0}function o(a){return a+1}function p(a){return a-1}function q(a){return function(b,c){return b+ +a(c)}}function r(a){return function(b,c){return b-a(c)}}function s(){function a(a){var b=z,c=a.length;return c&&(y=y.concat(a),D=F(D,z+=c),H.forEach(function(d){d(a,b,c)})),x}function d(){for(var a=t(z,z),b=[],c=0,d=0;z>c;++c)D[c]?a[c]=d++:b.push(c);E.forEach(function(a){a(0,[],b)}),I.forEach(function(b){b(a)});for(var e,c=0,d=0;z>c;++c)(e=D[c])&&(c!==d&&(D[d]=e,y[d]=y[c]),++d);for(y.length=d;z>d;)D[--z]=0}function g(a){function d(b,d,e){U=b.map(a),V=$(u(e),0,e),U=c(U,V);var f,g=_(U),h=g[0],i=g[1];if(W)for(f=0;e>f;++f)W(U[f],f)||(D[V[f]+d]|=Y);else{for(f=0;h>f;++f)D[V[f]+d]|=Y;for(f=i;e>f;++f)D[V[f]+d]|=Y}if(!d)return S=U,T=V,cb=h,db=i,void 0;var j=S,k=T,l=0,m=0;for(S=new Array(z),T=t(z,z),f=0;d>l&&e>m;++f)j[l]<U[m]?(S[f]=j[l],T[f]=k[l++]):(S[f]=U[m],T[f]=V[m++]+d);for(;d>l;++l,++f)S[f]=j[l],T[f]=k[l];for(;e>m;++m,++f)S[f]=U[m],T[f]=V[m]+d;g=_(S),cb=g[0],db=g[1]}function g(a,b,c){ab.forEach(function(a){a(U,V,b,c)}),U=V=null}function i(a){for(var b,c=0,d=0;z>c;++c)D[b=T[c]]&&(c!==d&&(S[d]=S[c]),T[d]=a[b],++d);for(S.length=d;z>d;)T[d++]=0;var e=_(S);cb=e[0],db=e[1]}function s(a){var b=a[0],c=a[1];if(W)return W=null,M(function(a,d){return d>=b&&c>d}),cb=b,db=c,X;var d,e,f,g=[],h=[];if(cb>b)for(d=b,e=Math.min(cb,c);e>d;++d)D[f=T[d]]^=Y,g.push(f);else if(b>cb)for(d=cb,e=Math.min(b,db);e>d;++d)D[f=T[d]]^=Y,h.push(f);if(c>db)for(d=Math.max(b,db),e=c;e>d;++d)D[f=T[d]]^=Y,g.push(f);else if(db>c)for(d=Math.max(cb,c),e=db;e>d;++d)D[f=T[d]]^=Y,h.push(f);return cb=b,db=c,E.forEach(function(a){a(Y,g,h)}),X}function x(a){return null==a?K():Array.isArray(a)?J(a):"function"==typeof a?L(a):C(a)}function C(a){return s((_=j(w,a))(S))}function J(a){return s((_=k(w,a))(S))}function K(){return s((_=l)(S))}function L(a){return _=l,M(W=a),cb=0,db=z,X}function M(a){var b,c,d,e=[],f=[];for(b=0;z>b;++b)!(D[c=T[b]]&Y)^(d=a(S[b],b))&&(d?(D[c]&=Z,e.push(c)):(D[c]|=Y,f.push(c)));E.forEach(function(a){a(Y,e,f)})}function N(a){for(var b,c=[],d=db;--d>=cb&&a>0;)D[b=T[d]]||(c.push(y[b]),--a);return c}function O(a){for(var b,c=[],d=cb;db>d&&a>0;)D[b=T[d]]||(c.push(y[b]),--a),d++;return c}function P(a){function c(b,c,d,e){function f(){++U===R&&(s=G(s,Q<<=1),K=G(K,Q),R=v(Q))}var k,l,n,o,p,q,r=J,s=t(U,R),u=N,w=P,x=U,A=0,B=0;for(X&&(u=w=m),J=new Array(U),U=0,K=x>1?F(K,z):t(z,R),x&&(n=(l=r[0]).key);e>B&&!((o=a(b[B]))>=o);)++B;for(;e>B;){for(l&&o>=n?(p=l,q=n,s[A]=U,(l=r[++A])&&(n=l.key)):(p={key:o,value:w()},q=o),J[U]=p;!(o>q||(K[k=c[B]+d]=U,D[k]&Z||(p.value=u(p.value,y[k])),++B>=e));)o=a(b[B]);f()}for(;x>A;)J[s[A]=U]=r[A++],f();if(U>A)for(A=0;d>A;++A)K[A]=s[K[A]];k=E.indexOf(V),U>1?(V=g,W=i):(1===U?(V=h,W=j):(V=m,W=m),K=null),E[k]=V}function d(){if(U>1){for(var a=U,b=J,c=t(a,a),d=0,e=0;z>d;++d)D[d]&&(c[K[e]=K[d]]=1,++e);for(J=[],U=0,d=0;a>d;++d)c[d]&&(c[d]=U++,J.push(b[d]));if(U>1)for(var d=0;e>d;++d)K[d]=c[K[d]];else K=null;E[E.indexOf(V)]=U>1?(W=i,V=g):1===U?(W=j,V=h):W=V=m}else if(1===U){for(var d=0;z>d;++d)if(D[d])return;J=[],U=0,E[E.indexOf(V)]=V=W=m}}function g(a,b,c){if(a!==Y&&!X){var d,e,f,g;for(d=0,f=b.length;f>d;++d)D[e=b[d]]&Z||(g=J[K[e]],g.value=N(g.value,y[e]));for(d=0,f=c.length;f>d;++d)(D[e=c[d]]&Z)===a&&(g=J[K[e]],g.value=O(g.value,y[e]))}}function h(a,b,c){if(a!==Y&&!X){var d,e,f,g=J[0];for(d=0,f=b.length;f>d;++d)D[e=b[d]]&Z||(g.value=N(g.value,y[e]));for(d=0,f=c.length;f>d;++d)(D[e=c[d]]&Z)===a&&(g.value=O(g.value,y[e]))}}function i(){var a,b;for(a=0;U>a;++a)J[a].value=P();for(a=0;z>a;++a)D[a]&Z||(b=J[K[a]],b.value=N(b.value,y[a]))}function j(){var a,b=J[0];for(b.value=P(),a=0;z>a;++a)D[a]&Z||(b.value=N(b.value,y[a]))}function k(){return X&&(W(),X=!1),J}function l(a){var b=L(k(),0,J.length,a);return M.sort(b,0,b.length)}function s(a,b,c){return N=a,O=b,P=c,X=!0,H}function u(){return s(o,p,n)}function w(a){return s(q(a),r(a),n)}function x(a){function b(b){return a(b.value)}return L=f(b),M=e(b),H}function A(){return x(b)}function B(){return U}function C(){var a=E.indexOf(V);return a>=0&&E.splice(a,1),a=ab.indexOf(c),a>=0&&ab.splice(a,1),a=I.indexOf(d),a>=0&&I.splice(a,1),H}var H={top:l,all:k,reduce:s,reduceCount:u,reduceSum:w,order:x,orderNatural:A,size:B,dispose:C,remove:C};bb.push(H);var J,K,L,M,N,O,P,Q=8,R=v(Q),U=0,V=m,W=m,X=!0;return arguments.length<1&&(a=b),E.push(V),ab.push(c),I.push(d),c(S,T,0,z),u().orderNatural()}function Q(){var a=P(m),b=a.all;return delete a.all,delete a.top,delete a.order,delete a.orderNatural,delete a.size,a.value=function(){return b()[0].value},a}function R(){bb.forEach(function(a){a.dispose()});var a=H.indexOf(d);for(a>=0&&H.splice(a,1),a=H.indexOf(g),a>=0&&H.splice(a,1),a=I.indexOf(i),a>=0&&I.splice(a,1),a=0;z>a;++a)D[a]&=Z;return A&=Z,X}var S,T,U,V,W,X={filter:x,filterExact:C,filterRange:J,filterFunction:L,filterAll:K,top:N,bottom:O,group:P,groupAll:Q,dispose:R,remove:R},Y=~A&-~A,Z=~Y,$=h(function(a){return U[a]}),_=l,ab=[],bb=[],cb=0,db=0;return H.unshift(d),H.push(g),I.push(i),A|=Y,(B>=32?!Y:A&(1<<B)-1)&&(D=G(D,B<<=1)),d(y,0,z),g(y,0,z),X}function i(){function a(a,b){var c;if(!s)for(c=b;z>c;++c)D[c]||(i=j(i,y[c]))}function b(a,b,c){var d,e,f;if(!s){for(d=0,f=b.length;f>d;++d)D[e=b[d]]||(i=j(i,y[e]));for(d=0,f=c.length;f>d;++d)D[e=c[d]]===a&&(i=k(i,y[e]))}}function c(){var a;for(i=l(),a=0;z>a;++a)D[a]||(i=j(i,y[a]))}function d(a,b,c){return j=a,k=b,l=c,s=!0,m}function e(){return d(o,p,n)}function f(a){return d(q(a),r(a),n)}function g(){return s&&(c(),s=!1),i}function h(){var c=E.indexOf(b);return c>=0&&E.splice(c),c=H.indexOf(a),c>=0&&H.splice(c),m}var i,j,k,l,m={reduce:d,reduceCount:e,reduceSum:f,value:g,dispose:h,remove:h},s=!0;return E.push(b),H.push(a),a(y,0,z),e()}function s(){return z}var x={add:a,remove:d,dimension:g,groupAll:i,size:s},y=[],z=0,A=0,B=8,D=C(0),E=[],H=[],I=[];return arguments.length?a(arguments[0]):x}function t(a,b){return(257>b?C:65537>b?D:E)(a)}function u(a){for(var b=t(a,a),c=-1;++c<a;)b[c]=c;return b}function v(a){return 8===a?256:16===a?65536:4294967296}s.version="1.3.5",s.permute=c;var w=s.bisect=d(b);w.by=d;var x=s.heap=e(b);x.by=e;var y=s.heapselect=f(b);y.by=f;var z=s.insertionsort=g(b);z.by=g;var A=s.quicksort=h(b);A.by=h;var B=32,C=i,D=i,E=i,F=b,G=b;"undefined"!=typeof Uint8Array&&(C=function(a){return new Uint8Array(a)},D=function(a){return new Uint16Array(a)},E=function(a){return new Uint32Array(a)},F=function(a,b){if(a.length>=b)return a;var c=new a.constructor(b);return c.set(a),c},G=function(a,b){var c;switch(b){case 16:c=D(a.length);break;case 32:c=E(a.length);break;default:throw new Error("invalid array width!")}return c.set(a),c}),a.crossfilter=s}(this),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.4";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?null:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return 0===b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=E(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&E(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:new RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),L.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=++H+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||I).source,(c.interpolate||I).source,(c.evaluate||I).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(K,function(a){return"\\"+J[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var L=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],L.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return L.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var AXIS_HEAD_SPACE_FACTOR,MAX_IMAGES,app,brushed,endTour,getURLParameters,hover,hoverAndHighlight,htmlEncode,launchTour,log,proceedTour,renderCharts,renderChartsThrottled,resetFilters,roundToPrecision,stepBackTour,tourState,track,unhover,unhoverAndUnhighlight,__slice=[].slice;log=function(){var a,b,c,d,e;for(b=1<=arguments.length?__slice.call(arguments,0):[],e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push("undefined"!=typeof console&&null!==console?console.log(a):void 0);return e},window.UNKNOWN=-9999999,app=window.app={},app.views=window.app.views={},app.views.charts=window.app.views.charts={},app.data={},app.charts=[],log("hello selfies!"),app.brushing=!1,app.brushhistory={},track=function(a,b,c){var d;try{return null!=c?ga("send","event",a,b+" "+c):ga("send","event",a,b)}catch(e){return d=e,""}},brushed=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(d3.event&&d3.event.type){k=void 0;try{d3.event.sourceEvent.currentTarget&&d3.event.sourceEvent.currentTarget!==window?k=d3.event.sourceEvent.currentTarget.parentElement.parentElement.parentElement.id:(k=d3.event.sourceEvent.srcElement.parentElement.parentElement.parentElement.id,k||(k=d3.event.sourceEvent.srcElement.parentElement.parentElement.parentElement.parentElement.id))}catch(t){k=void 0}k&&(d=+k.substr(5,2),app.brushhistory[d3.event.type]={chartDOM:k,chart:app.charts[d],brush:app.charts[d].brush,brushEmpty:!app.charts[d].brush()||app.charts[d].brush().empty()})}for(a=!1,s=app.charts,p=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o;return g=b.brush(),"bubble"===b.type()?(o=b._selectedBubbles,o.length===b._maximumSelectableBubbles.length?b.dimension().filterAll():(b.dimension().filter(function(a){return-1!==o.indexOf(a)}),a=!0)):g?(i="#clip-bar",10>c&&(i+="0"+c),c>=10&&(i+=c),g.empty()?(b._orientation&&"vertical"===b._orientation?d3.select(i).selectAll("rect").attr("height",b._totalHeight).attr("y",0):d3.select(i).selectAll("rect").attr("width",b._totalWidth).attr("x",0),b.dimension().filterAll()):(j=g.extent(),e=j[0],f=j[1],k=b._precision,l=b.xScale().domain()[0],b._orientation&&"vertical"===b._orientation&&(l=b.yScale().domain()[0]),m=b.xScale().domain()[1],b._orientation&&"vertical"===b._orientation&&(m=b.yScale().domain()[1]),n=m-l,e=(e-l)/n,e=roundToPrecision(e,k),e=l+n*e,f=(f-l)/n,f=roundToPrecision(f,k),f=l+n*f,n/k>f-e&&(f=e+n/k),f+=1e-4,f>m+1e-4&&(f=m+1e-4,n/k>f-e&&(e=f-n/k-1e-4)),d=[e,f],d3.event&&"brushend"===d3.event.type?(g.extent(d),h="#chart",10>c&&(h+="0"+c),c>=10&&(h+=c),d3.select(h).select(".brush").call(b.brush()),b._orientation&&"vertical"===b._orientation?d3.select(i).selectAll("rect").attr("height",b.yScale()(d[0])-b.yScale()(d[1])).attr("y",b.yScale()(d[1])):d3.select(i).selectAll("rect").attr("width",b.xScale()(d[1])-b.xScale()(d[0])).attr("x",b.xScale()(d[0]))):b._orientation&&"vertical"===b._orientation?d3.select(i).selectAll("rect").attr("height",b.yScale()(j[0])-b.yScale()(j[1])).attr("y",b.yScale()(j[1])):d3.select(i).selectAll("rect").attr("width",b.xScale()(j[1])-b.xScale()(j[0])).attr("x",b.xScale()(j[0])),b.dimension().filterRange(d),a=!0)):void 0
},h=q=0,r=s.length;r>q;h=++q)c=s[h],p(c,h);if(d3.event&&"brushstart"===d3.event.type&&(app.charts[app.charts.length-1].fadeDownImages(),app.brushing=!0,$("body").css("cursor","col-resize")),l=!1,d3.event&&"brushend"===d3.event.type){if(l=!0,app.brushing=!1,app.brushhistory.brushstart&&app.brushhistory.brushend&&app.brushhistory.brushstart.brushEmpty&&app.brushhistory.brushend.brushEmpty&&app.brushhistory.brushstart.chartDOM===app.brushhistory.brushend.chartDOM)track("brushClick",app.brushhistory.brushend.chartDOM),b=app.brushhistory.brushend.chart,"bubble"!==b.type()&&(j=d3.mouse(document.getElementById(app.brushhistory.brushend.chartDOM)),n=1,m=0,b._orientation&&"vertical"===b._orientation?(i=(b._totalHeight-j[1])/b._totalHeight,m=b.yScale().domain()[0],n=b.yScale().domain()[1]):(i=j[0]/b._totalWidth,m=b.xScale().domain()[0],n=b.xScale().domain()[1]),o=n-m,e=o/b._precision/2,i=m+i*o,app.brushhistory.brushend.brush().extent([i-e,i+e]),d3.select("#"+app.brushhistory.brushend.chartDOM).select(".brush").call(app.brushhistory.brushend.brush()),app.brushhistory={},a=!0,brushed());else try{g=app.brushhistory.brushend.brush().extent(),g[0]===g[1]?track("brushClose",app.brushhistory.brushend.chartDOM):track("brushChange",app.brushhistory.brushend.chartDOM,g)}catch(t){f=t}app.brushhistory={}}return d3.event&&"click"===d3.event.type&&(l=!0),renderChartsThrottled(l),a?$("body").removeClass("no-filter-active").addClass("filter-active"):$("body").removeClass("filter-active").addClass("no-filter-active"),d3.select("#selectedFaces").text(app.data.all.value())},app.pendingHoveringCall=void 0,app.hoverHighlightDelay=1e3,hover=function(){},unhover=function(){},hoverAndHighlight=function(a,b){var c;return null!=app.pendingHoveringCall&&clearTimeout(app.pendingHoveringCall),app.brushing?void 0:(c=function(){var c;return c=app.charts[app.charts.length-1],c.highlightImages(a,b)},app.pendingHoveringCall=setTimeout(c,app.hoverHighlightDelay))},unhoverAndUnhighlight=function(a){var b,c,d;if(!app.brushing||null!=app.pendingHoveringCall)return null!=app.pendingHoveringCall&&clearTimeout(app.pendingHoveringCall),app.pendingHoveringCall=void 0,b=a.brush(),"bubble"===a.type()?a._selectedBubbles.length===a._maximumSelectableBubbles.length?a.dimension().filterAll():a.dimension().filter(function(b){return-1!==a._selectedBubbles.indexOf(b)}):b&&!b.empty()?(c=b.extent(),c[1]+=.001,a.dimension().filterRange(c)):a.dimension().filterAll(),app.brushing?void 0:(d=app.charts[app.charts.length-1],d.unhighlightImages(a))},renderCharts=function(a){var b,c,d,e,f,g;for(f=app.charts,g=[],c=d=0,e=f.length;e>d;c=++d)b=f[c],g.push(function(b,c){var d;return d="#chart",10>c&&(d+="0"+c),c>=10&&(d+=c),"grid"!==b.id()||a?d3.select(d).call(b.render):void 0}(b,c));return g},renderChartsThrottled=_.throttle(renderCharts,100),app.removeFilter=function(a){var b,c;return c=a.substring(5),b=app.charts[+c],b.brush().clear(),d3.select("#"+a).selectAll(".brush").call(b.brush()),brushed()},resetFilters=function(){var a,b,c,d,e,f;for(f=app.charts,c=function(a,b){var c;return null!=a.brush()?(a.brush().clear(),c="#chart",10>b&&(c+="0"+b),b>=10&&(c+=b),d3.select(c).select(".brush").call(a.brush())):(a._selectedBubbles=[],a._selectedBubbles=a._maximumSelectableBubbles)},b=d=0,e=f.length;e>d;b=++d)a=f[b],c(a,b);return brushed(),renderChartsThrottled(!0)},getURLParameters=function(a){var b,c,d,e,f,g,h,i;if(b={},f=a.indexOf("?"),-1===f)return b;for(c=a.substring(f+1),c=unescape(c),e=c.split("&"),g=function(a){return a=a.split("="),b[a[0]]=a[1]},h=0,i=e.length;i>h;h++)d=e[h],g(d);return b},app.dumpFilterExtents=function(){var a,b,c,d,e,f,g,h;for(b="",d=!0,h=app.charts,e=function(a,c){var e,f,g,h,i,j;if(e=a.brush(),"bubble"===a.type()){if(h=a._selectedBubbles,h.length!==a._maximumSelectableBubbles.length){for(b.length>0&&(b+="&"),b+=a.id()+"=[",d=!1,c=i=0,j=h.length;j>i;c=++i)f=h[c],c<h.length-1&&(b+=f+",");return b+=h[h.length-1]+"]"}}else if(e&&!e.empty())return b.length>0&&(b+="&"),d=!1,g=e.extent(),b+=a.id()+("=["+g[0].toFixed(3)+","+g[1].toFixed(3)+"]")},c=f=0,g=h.length;g>f;c=++f)a=h[c],e(a,c);return d?"":b},tourState=-1,launchTour=function(){return track("tour","started"),$(".tourButton").css("opacity",0),$("body").addClass("tour-active"),$(".stepForwardTour","#tour").unbind().click(proceedTour),$(".stepBackwardsTour","#tour").unbind().click(stepBackTour),$(".skipTourButton","#tour").unbind().click(endTour),resetFilters(),proceedTour()},stepBackTour=function(){var a;return tourState--,0>tourState&&(tourState=0),track("tour",tourState),a=$("body").attr("class").split(" "),a=_.filter(a,function(a){return-1===a.indexOf("tour-step-")}),a.push("tour-step-"+tourState),$("body").attr("class",a.join(" ")),$(".tourStep").not("#tourStep"+tourState).transition({opacity:0,visibility:"hidden"}),$("#tourStep"+tourState).transition({opacity:1,visibility:"visible"})},proceedTour=function(){var a;return tourState++,track("tour",tourState),a=$("body").attr("class").split(" "),a=_.filter(a,function(a){return-1===a.indexOf("tour-step-")}),a.push("tour-step-"+tourState),$("body").attr("class",a.join(" ")),$(".tourStep").not("#tourStep"+tourState).transition({opacity:0,visibility:"hidden"}),$("#tourStep"+tourState).transition({opacity:1,visibility:"visible"}),0===tourState?$("#tour").fadeIn(500):void 0},endTour=function(){return track("tour","ended"),$("body").removeClass("tour-active"),$(".tourButton").css("opacity",1),$(".tourStep").transition({opacity:0,visibility:"hidden"}),$("#tour").fadeOut(500),tourState=-1},htmlEncode=function(a){return $("<div/>").text(a).html()},roundToPrecision=function(a,b){var c;return c=a*b,c=Math.round(c),c/b},app.visualize=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;for(console.log(a),G=0,J=a.length;J>G;G++){y=a[G];for(B in y)""===y[B]&&(y[B]=UNKNOWN)}for(app.data.faces=crossfilter(a),A=15,x=6,r=function(a,b,c){var d;return d=+a[b],null!=c&&(d=1-d),.3333>=d?"left":d>=.6666?"right":"middle"},app.data.all=app.data.faces.groupAll(),app.data.age=app.data.faces.dimension(function(a){var b;return b=a.combined_age_guess,b>50&&(b=50),5*Math.round(b/5)}),app.data.sex=app.data.faces.dimension(function(a){return r(a,"combined_gender_guess")}),app.data.eye_closed=app.data.faces.dimension(function(a){return r(a,"eye_closed")}),app.data.glasses=app.data.faces.dimension(function(a){return r(a,"glasses")}),app.data.mouth_wide_open=app.data.faces.dimension(function(a){return r(a,"mouth_open_wide",!0)}),app.data.smile=app.data.faces.dimension(function(a){return roundToPrecision((+a.smile).toFixed(2),A)}),app.data.calm=app.data.faces.dimension(function(a){return isFinite(+a.emotion_calm)?roundToPrecision((+a.emotion_calm).toFixed(2),A):UNKNOWN}),app.data.angry=app.data.faces.dimension(function(a){return isFinite(+a.emotion_angry)?roundToPrecision((+a.emotion_angry).toFixed(2),A):UNKNOWN}),app.data.sad=app.data.faces.dimension(function(a){return isFinite(+a.emotion_sad)?roundToPrecision((+a.emotion_sad).toFixed(2),A):UNKNOWN}),app.data.happy=app.data.faces.dimension(function(a){return isFinite(+a.emotion_happy)?roundToPrecision((+a.emotion_happy).toFixed(2),A):UNKNOWN}),app.data.dataset=app.data.faces.dimension(function(a){return a.city}),app.data.pitch=app.data.faces.dimension(function(a){return x*Math.round(-a.pose_pitch/x)}),app.data.yaw=app.data.faces.dimension(function(a){return x*Math.round(a.pose_yaw/x)}),app.data.roll=app.data.faces.dimension(function(a){return x*Math.round(a.pose_roll/x)}),app.data.url=app.data.faces.dimension(function(a){return a.id?a.city+"/"+a.id:"llalsll"}),d3.select("#selectedFaces").text(app.data.all.value()),d3.select("#totalFaces").text(app.data.faces.size()),app.charts=[],u={dataset:[],bar01:[],bar02:[],bar03:[],bar04:[],bar05:[],bar06:[],bar07:[],bar08:[],bar09:[],bar10:[],bar11:[],bar12:[]},D=getURLParameters(window.location.href),w=!1,M=Object.keys(D),E=function(a){var b,c,d,e,f,g,h;if(u[a]&&"[]"!==D[a]&&0===D[a].indexOf("[")&&D[a].indexOf("]")===D[a].length-1){if(b=[],d=D[a].substring(1,D[a].length-1).split(","),"dataset"===a||"bar02"===a||"bar06"===a||"bar07"===a||"bar08"===a){for(e=0,g=d.length;g>e;e++)c=d[e],b.push(c);u[a]=b}else if(d.length>1){for(f=0,h=d.length;h>f;f++)c=d[f],b.push(+c);u[a]=b}return w=!0}},H=0,K=M.length;K>H;H++)z=M[H],E(z);for(p={bangkok:{x:.8,y:.48},berlin:{x:.5,y:.24},moscow:{x:.58,y:.18},ny:{x:.27,y:.27},sao_paulo:{x:.33,y:.7},tokyo:{x:1,y:.5},london:{x:.42,y:.18}},q={bangkok:"Bangkok",berlin:"Berlin",moscow:"Moscow",ny:"New York City",sao_paulo:"SÃ£o Paulo",tokyo:"Toyko",london:"London"},C={left:{x:.2,y:.5},middle:{x:.5,y:.5},right:{x:.8,y:.5}},O=.5,c=app.views.charts.bubbleChart().id("dataset").dimension(app.data.dataset).verticalParameter("value").positions(p).maximumCircleSize(.2).width($("#chart00").parent().width()).height(150).initialBrushExtent(u.dataset).tooltipScale(q).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),d=app.views.charts.polygonChart().id("bar01").dimension(app.data.age).verticalParameter("value").width($("#chart01").parent().width()).height(70).initialBrushExtent(u.bar01).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),g=app.views.charts.bubbleChart().id("bar02").dimension(app.data.sex).verticalParameter("value").positions(C).maximumCircleSize(O).width($("#chart01").parent().width()).height(73).initialBrushExtent(u.bar02).tooltipScale(void 0).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),h=app.views.charts.verticalDualPolygonChart().id("bar03").dimension(app.data.pitch).verticalParameter("value").width($("#chart03").parent().width()).height(303).initialBrushExtent(u.bar03).tooltipScale(["",""]).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),i=app.views.charts.dualPolygonChart().id("bar04").dimension(app.data.yaw).verticalParameter("value").width($("#chart04").parent().width()).height(142).initialBrushExtent(u.bar04).tooltipScale(void 0).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),j=app.views.charts.semiCirclePolygonChart().id("bar05").dimension(app.data.roll).verticalParameter("value").width($("#chart05").parent().width()).height(153).initialBrushExtent(u.bar05).tooltipScale(void 0).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),k=app.views.charts.bubbleChart().id("bar06").dimension(app.data.eye_closed).verticalParameter("value").positions(C).maximumCircleSize(O).width($("#chart06").parent().width()).height(96).initialBrushExtent(u.bar06).tooltipScale(void 0).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),l=app.views.charts.bubbleChart().id("bar07").dimension(app.data.mouth_wide_open).verticalParameter("value").positions(C).maximumCircleSize(O).width($("#chart07").parent().width()).height(96).initialBrushExtent(u.bar07).tooltipScale(void 0).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),m=app.views.charts.bubbleChart().id("bar08").dimension(app.data.glasses).verticalParameter("value").positions(C).maximumCircleSize(O).width($("#chart08").parent().width()).height(96).initialBrushExtent(u.bar08).tooltipScale(void 0).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),n=app.views.charts.polygonChart().id("bar09").dimension(app.data.calm).verticalParameter("value").width($("#chart09").parent().width()).height(96).initialBrushExtent(u.bar09).tooltipScale(["not calm","calm"]).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),e=app.views.charts.polygonChart().id("bar10").dimension(app.data.angry).verticalParameter("value").width($("#chart10").parent().width()).height(96).initialBrushExtent(u.bar10).tooltipScale(["not angry","angry"]).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),f=app.views.charts.polygonChart().id("bar11").dimension(app.data.happy).verticalParameter("value").width($("#chart11").parent().width()).height(96).initialBrushExtent(u.bar11).tooltipScale(["not happy","happy"]).brushed(brushed).hoverCallback(hover).unhoverCallback(unhover),app.charts.push(c,d,g,h,i,j,k,l,m,n,e,f),v={},N=app.charts,F=function(a,b){var c;return c="#chart",10>b&&(c+="0"+b),b>=10&&(c+=b),d3.select(c).call(a.setup).call(a.render)},s=I=0,L=N.length;L>I;s=++I)o=N[s],F(o,s);return brushed(),t=app.views.charts.imageGrid().id("grid").dimension(app.data.url).picsPerCol(3).pathPrefix(b).currentPathPrefix(b.normal),app.charts.push(t),d3.select("#chart12").call(t.setup).call(t.render),w?$("body").addClass("filter-active"):$("body").addClass("no-filter-active"),d3.select("#dumpFilters").on("click",function(){var a,b,c,d,e,f,g,h;return c=app.dumpFilterExtents(),h=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+c+"&",e="Look what I found on @selfie_city!",b="Look what I found on @selfiecity!",d="The selfiexploratory on selfiecity lets you explore thousands of selfies and learn about the patterns in this fascinating data.",f=e+" "+h,g="../assets/img/selfiexploratory.jpg",track("openShareDialog",f),$(".linkBox","#copyViewPopup").text(h).focus(),$("#facebookShareLink","#copyViewPopup").attr("href","https://www.facebook.com/sharer/sharer.php?s=100&p[url]="+escape(h)+"&p[title]="+escape(b)+"&p[images][0]="+escape(g)+"&p[summary]="+escape(d)),$("#twitterShareLink","#copyViewPopup").attr("href","http://twitter.com/home?status="+escape(f)),$("#googlePlusShareLink","#copyViewPopup").attr("href","https://plus.google.com/share?url="+escape(h)),a=$("#dumpFilters").position(),$("#copyViewPopup").css({left:a.left-180+"px",top:a.top+40+"px"}).fadeIn(),$("#overlay").on("click",function(){return track("closeShareDialog",""),$("#copyViewPopup").fadeOut(),$("#overlay").fadeOut()}).fadeIn()}),d3.select("#reset").on("click",function(){return track("resetFilters",""),resetFilters()}),$(window).on("resize",function(){return d3.select("#chart12").call(t.render)}),$(".tourButton").click(launchTour),window.spinner.stop(),$("#spinnerContainer").fadeOut(1e3,function(){return $(this).remove()}),$(".controls").fadeIn(1e3),$(".tourButton").css("opacity","1")},app.views.charts.abstractChart=function(){var a;return a={},a._width=400,a._height=200,a._margin={top:0,right:0,bottom:0,left:0},a._verticalParameter="y",a._emptyWidth=6,a._emptyHeight=6,a._sortingPrefix=1,a._barChartPadding=.4,a._dataStringFormat="0,0",a._dataStringUnit="",a._label="",a._tooltipScale={},a._axisHeight=18,a._interaction={mouseover:function(){},mousemove:function(){},mouseout:function(){},click:function(){}},a._initialBrushExtent=[],a._hoverCallback=function(){},a._unhoverCallback=function(){},a.width=function(b){return arguments.length?(a._width=b,a):a._width},a.height=function(b){return arguments.length?(a._height=b,a):a._height},a.margin=function(b){return arguments.length?(a._margin=b,a):a._margin},a.verticalParameter=function(b){return arguments.length?(a._verticalParameter=b,a):a._verticalParameter},a.emptyHeight=function(b){return arguments.length?(a._emptyHeight=b,a):a._emptyHeight},a.dataStringFormat=function(b){return arguments.length?(a._dataStringFormat=b,a):a._dataStringFormat},a.dataStringUnit=function(b){return arguments.length?(a._dataStringUnit=b,a):a._dataStringUnit},a.sortingPrefix=function(b){return arguments.length?(a._sortingPrefix=+b,a):a._sortingPrefix},a.barChartPadding=function(b){return arguments.length?(a._barChartPadding=b,a):a._barChartPadding},a.label=function(b){return arguments.length?(a._label=b,a):a._label},a.tooltipScale=function(b){return arguments.length?(a._tooltipScale=b,a):a._tooltipScale},a.interaction=function(b){return arguments.length?(a._interaction=b,a):a._interaction},a.emptyWidth=function(b){return arguments.length?(a._emptyWidth=b,a):a._emptyWidth},a.emptyHeight=function(b){return arguments.length?(a._emptyHeight=b,a):a._emptyHeight},a.initialBrushExtent=function(b){return arguments.length?(a._initialBrushExtent=b,a):a._initialBrushExtent},a.hoverCallback=function(b){return arguments.length?(a._hoverCallback=b,a):a._hoverCallback},a.unhoverCallback=function(b){return arguments.length?(a._unhoverCallback=b,a):a._unhoverCallback},a.type=function(){return"abstract"},a.sortData=function(b){return b=_.sortBy(b,function(b){return a._sortingPrefix*b[a._verticalParameter]})},a.isDataMissing=function(b){return-1===b[a._verticalParameter]},a.formatData=function(b){return a.isDataMissing(b)?"unavailable":""+b[a._verticalParameter]+a._dataStringUnit},a.createSvg=function(b,c){var d,e,f;return f=d3.select(b).selectAll("svg").data([c]),e=f.enter().append("svg").append("g"),e.append("g").attr("class","bars"),e.append("g").attr("class","axis"),f.attr("width",a._width).attr("height",a._height),d=f.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),[f,d]},a.render=function(){},a},AXIS_HEAD_SPACE_FACTOR=3,app.views.charts.barChart=function(){return function(a){return a._barChartPadding=.25,a._id=0,a._axis_width=40,a._brush=void 0,a._margin.right=10,a._dimension=void 0,a._group=function(a){return a},a._brushed=function(){return console.log(a._brush.extent())},a._verticalParameter="value",a.id=function(b){return arguments.length?(a._id=b,a):a._id},a.dimension=function(b){return arguments.length?(a._dimension=b,a):a._dimension},a.group=function(b){return arguments.length?(a._group=b,a):a._group},a.brush=function(b){return arguments.length?(a._brushed=b,a):a._brush},a.brushed=function(b){return arguments.length?(a._brushed=b,a):a._brushed},a.xScale=function(b){return arguments.length?(a._xScale=b,a):a._xScale},a.yScale=function(b){return arguments.length?(a._yScale=b,a):a._yScale},a.setup=function(b){return b.each(function(){var b,c,d,e,f,g,h,i,j,k,l;return d=a._dimension.group(a._group).reduceCount().top(100),d=_.filter(d,function(a){return+a.key!==window.UNKNOWN}),d=_.sortBy(d,function(a){return a.key}),l=a._width-a._margin.left-a._margin.right-a._axis_width,k=a._height-a._margin.top-a._margin.bottom-a._axisHeight,h=d3.min(d,function(a){return a.key}),h=0,i=1.1*d3.max(d,function(a){return a.key}),null==a._xScale&&(a._xScale=d3.scale.linear().domain([h,i]).rangeRound([0,l])),null==a._yScale&&(a._yScale=d3.scale.linear().domain([0,d3.max(d,function(b){return AXIS_HEAD_SPACE_FACTOR*b[a._verticalParameter]/app.data.faces.size()})]).range([k,0])),j=d3.select(this).selectAll("svg").data([d]),g=j.enter().append("svg").append("g"),g.append("rect").classed("chart-bg",!0).attr({width:a._width,height:k}),g.append("g").attr("class","x_axis"),g.append("g").attr("class","y_axis"),g.append("g").attr("class","bars"),c=g.append("g").attr("class","backgroundBars"),a._brush=d3.svg.brush().x(a._xScale).on("brush",a._brushed),f=g.append("g").attr("class","brush").call(a._brush),f.selectAll("rect").attr("height",k),g.append("clipPath").attr("id","clip-"+a._id).append("rect").attr("width",l+5).attr("height",k),g.selectAll(".bars").attr("clip-path","url(#clip-"+a._id+")"),j.attr("width",a._width).attr("height",a._height),e=j.select("g").attr("transform","translate("+(a._margin.left+a._axis_width)+","+a._margin.top+")"),e.select("g.x_axis").attr("transform","translate(0, "+k+")"),e.select("g.y_axis").attr("transform","translate(-2, 0)"),b=e.select(".backgroundBars").selectAll(".bar").data(d),b.enter().append("rect"),b.exit().remove(),b.classed("backgroundBar",!0).attr("width","4px").attr("x",function(b){return a._xScale(b.key)}).attr("y",function(b){return a._yScale(b[a._verticalParameter]/app.data.all.value())}).attr("height",function(b){return Math.max(0,k-a._yScale(b[a._verticalParameter]/app.data.all.value()))})})},a.render=function(b){return b.each(function(){var b,c,d,e,f,g,h,i;return c=a._dimension.group(a._group).reduceCount().top(100),c=_.filter(c,function(a){return+a.key!==window.UNKNOWN}),c=_.sortBy(c,function(a){return a.key}),g=a._width-a._margin.left-a._margin.right-a._axis_width,f=a._height-a._margin.top-a._margin.bottom-a._axisHeight,a._totalWidth=g,a._yScale.domain([0,d3.max(c,function(b){return AXIS_HEAD_SPACE_FACTOR*b[a._verticalParameter]/app.data.all.value()})]),e=d3.select(this).selectAll("svg"),d=e.select("g"),b=d.select(".bars").selectAll(".bar").data(c),b.enter().append("rect"),b.exit().remove(),b.classed("bar",!0).attr("width","4px").attr("x",function(b){return a._xScale(b.key)}).attr("y",function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._yScale(b[a._verticalParameter]/app.data.all.value()):a._yScale(b[a._verticalParameter])}).attr("height",function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?Math.max(0,f-a._yScale(b[a._verticalParameter]/app.data.all.value())):Math.max(0,f-a._yScale(b[a._verticalParameter]))}),h=d3.svg.axis().scale(a._xScale).ticks(5),i=d3.svg.axis().scale(a._yScale).orient("left").ticks(3).tickSize(-500).tickFormat(function(a){return(100*a).toFixed(1)+"%"}),e.select(".x_axis").call(h),e.select(".y_axis").call(i)})},a}(app.views.charts.abstractChart())},app.views.charts.bubbleChart=function(){return function(a){return a._barChartPadding=.25,a._id=0,a._axis_width=40,a._brush=void 0,a._margin.right=10,a._dimension=void 0,a._group=function(a){return a},a._brushed=function(){},a._verticalParameter="value",a._positions={},a._maximumCircleSize=.5,a._selectedBubbles=[],a._maximumSelectableBubbles=[],a.id=function(b){return arguments.length?(a._id=b,a):a._id},a.dimension=function(b){return arguments.length?(a._dimension=b,a):a._dimension},a.group=function(b){return arguments.length?(a._group=b,a):a._group},a.brush=function(b){return arguments.length?(a._brush=b,a):a._brush},a.brushed=function(b){return arguments.length?(a._brushed=b,a):a._brushed},a.xScale=function(b){return arguments.length?(a._xScale=b,a):a._xScale},a.yScale=function(b){return arguments.length?(a._yScale=b,a):a._yScale},a.positions=function(b){return arguments.length?(a._positions=b,a):a._positions},a.maximumCircleSize=function(b){return arguments.length?(a._maximumCircleSize=b,a):a._maximumCircleSize},a.type=function(){return"bubble"},a.setup=function(b){return b.each(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(b=a._dimension.group(a._group).reduceCount().top(100),b=_.filter(b,function(a){return+a.key!==window.UNKNOWN}),b=_.sortBy(b,function(a){return a.key}),a._initialBrushExtent&&0!==a._initialBrushExtent.length)for(v=a._initialBrushExtent,p=0,s=v.length;s>p;p++)g=v[p],a._selectedBubbles.push(g);else for(u=_.pluck(b,"key"),o=0,r=u.length;r>o;o++)g=u[o],a._selectedBubbles.push(g);for(w=_.pluck(b,"key"),q=0,t=w.length;t>q;q++)g=w[q],a._maximumSelectableBubbles.push(g);return n=a._width,m=a._height,j=Math.min(n,m),a._rScale=d3.scale.sqrt().domain([0,1]).rangeRound([0,j*a._maximumCircleSize]),k=d3.select(this).selectAll("svg").data([b]),f=k.enter().append("svg").append("g"),h=function(b){return a._selectedBubbles=[],a._selectedBubbles=a._maximumSelectableBubbles,a._brushed(b)},f.append("rect").classed("chart-bg",!0).classed("transparent",!0).attr({width:n,height:m}).on("click",h),f.append("g").attr("class","bubbles"),c=f.append("g").attr("class","backgroundBubbles"),l=f.append("g").attr("class","tooltip").attr("id",a._id+"tooltip"),l.append("text").classed("tooltipText",!0).attr("text-anchor","end").attr("y",0).attr("x",-5).text(""),k.attr("width",a._width).attr("height",a._height),e=k.select("g"),i=function(b){return 1===a._selectedBubbles.length&&a._selectedBubbles[0]===b.key?(a._selectedBubbles=a._maximumSelectableBubbles,track("brushClose",a.id())):(a._selectedBubbles=[b.key],track("brushChange",a.id(),b.key)),a._brushed(b)},d=e.select(".backgroundBubbles").selectAll(".backgroundBubble").data(b),d.enter().append("circle"),d.exit().remove(),d.classed("backgroundBubble",!0).attr("cx",function(b){return a._positions[b.key].x*n}).attr("cy",function(b){return a._positions[b.key].y*m}).attr("r",function(b){return a._rScale(b[a._verticalParameter]/app.data.all.value())}).on("click",i)})},a.render=function(b){return b.each(function(b){var c,d,e,f,g,h;return b=a._dimension.group(a._group).reduceCount().top(100),b=_.filter(b,function(a){return+a.key!==window.UNKNOWN}),b=_.sortBy(b,function(a){return a.key}),a._precision=b.length,h=a._width,g=a._height,f=d3.select(this).selectAll("svg"),d=f.select("g"),e=function(b){return 1===a._selectedBubbles.length&&a._selectedBubbles[0]===b.key?(a._selectedBubbles=a._maximumSelectableBubbles,track("brushClose",a.id())):(a._selectedBubbles=[b.key],track("brushChange",a.id(),b.key)),a._brushed(b)},c=f.select(".bubbles").selectAll(".bubble").data(b),c.enter().append("circle"),c.exit().remove(),c.attr("cx",function(b){return a._positions[b.key].x*h}).attr("cy",function(b){return a._positions[b.key].y*g}).attr("r",function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._rScale(b[a._verticalParameter]/app.data.all.value()):a._rScale(b[a._verticalParameter])}).style("visibility",function(b){return-1!==a._selectedBubbles.indexOf(b.key)?"visible":"hidden"}).attr("class",function(b){var c;return c="bubble",1===a._selectedBubbles.length&&a._selectedBubbles[0]===b.key&&(c+=" extent"),c}).on("click",e),null!=a._tooltipScale?f.selectAll("circle").on("mouseover",function(b){var c,d,e,f;return d=d3.mouse(this),d3.select("#"+a._id+"tooltip").attr("transform","translate("+d[0]+", "+d[1]+")").style("visibility","visible"),f=b.key,a._hoverCallback(a,f),c=d[0]<h/2,e=a._tooltipScale[f],d3.select("#"+a._id+"tooltip").select(".tooltipText").text(e).attr("x",function(){return c?5:-5}).attr("text-anchor",function(){return c?"start":"end"})}).on("mousemove",function(b){var c,d,e,f;return d=d3.mouse(this),d3.select("#"+a._id+"tooltip").attr("transform","translate("+d[0]+", "+d[1]+")").style("visibility","visible"),f=b.key,a._hoverCallback(a,f),c=d[0]<h/2,e=a._tooltipScale[f],d3.select("#"+a._id+"tooltip").select(".tooltipText").text(e).attr("x",function(){return c?5:-5}).attr("text-anchor",function(){return c?"start":"end"})}).on("mouseout",function(){return a._unhoverCallback(a),d3.select("#"+a._id+"tooltip").style("visibility","hidden")}):void 0})},a}(app.views.charts.abstractChart())},AXIS_HEAD_SPACE_FACTOR=1.1,app.views.charts.dualPolygonChart=function(){return function(a){return a._barChartPadding=.25,a._id=0,a._axisWidth=0,a._axisHeight=0,a._brush=void 0,a._margin.left=0,a._margin.right=0,a._dimension=void 0,a._group=function(a){return a},a._brushed=function(){return console.log(a._brush.extent())},a._verticalParameter="value",a.id=function(b){return arguments.length?(a._id=b,a):a._id},a.dimension=function(b){return arguments.length?(a._dimension=b,a):a._dimension},a.group=function(b){return arguments.length?(a._group=b,a):a._group},a.brush=function(b){return arguments.length?(a._brush=b,a):a._brush},a.brushed=function(b){return arguments.length?(a._brushed=b,a):a._brushed},a.xScale=function(b){return arguments.length?(a._xScale=b,a):a._xScale},a.yScale=function(b){return arguments.length?(a._yScale=b,a):a._yScale},a.type=function(){return"dualpolygon"},a.setup=function(b){return b.each(function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;return c=a._dimension.group(a._group).reduceCount().top(100),c=_.filter(c,function(a){return+a.key!==window.UNKNOWN}),c=_.sortBy(c,function(a){return a.key}),n=a._width-a._margin.left-a._margin.right,m=a._height-a._margin.top-a._margin.bottom-a._axisHeight,g=d3.min(c,function(a){return a.key}),j=d3.max(c,function(a){return a.key}),null==a._xScale&&(a._xScale=d3.scale.linear().domain([g,j]).rangeRound([0,n])),null==a._yScale&&(a._yScale=d3.scale.sqrt().domain([0,d3.max(c,function(b){return AXIS_HEAD_SPACE_FACTOR*b[a._verticalParameter]/app.data.faces.size()})]).range([m/2,0]),a._invertedYScale=d3.scale.sqrt().domain([0,d3.max(c,function(b){return AXIS_HEAD_SPACE_FACTOR*b[a._verticalParameter]/app.data.faces.size()})]).range([m/2,m])),k=d3.select(this).selectAll("svg").data([c]),f=k.enter().append("svg").append("g"),f.append("rect").classed("chart-bg",!0).attr({width:n,height:m}),f.append("g").attr("class","x_axis"),f.append("g").attr("class","bars"),b=f.append("g").attr("class","background"),f.append("g").attr("class","separator").append("line").classed("separatorLine",!0).attr("x1","0").attr("y1",m/2).attr("x2",n).attr("y2",m/2),l=f.append("g").attr("class","tooltip").attr("id",a._id+"tooltip"),l.append("line").classed("tooltipLine",!0).attr("x1",.5).attr("x2",.5).attr("y1",0).attr("y2",m).attr("id",a._id+"tooltip"),l.append("text").classed("tooltipText",!0).attr("text-anchor","end").attr("x",5).attr("y",40).text("hello"),d3.select(this).on("mouseover",function(){var b,c,d,e;return a._brush.empty()?(d=d3.mouse(this)[0],d3.select("#"+a._id+"tooltip").attr("transform","translate("+d+", 0)").style("visibility","visible"),c=n/2>=d,b=Math.abs(d-n/2),e=a._xScale.invert(d).toFixed(2),null!=a._tooltipScale&&a._tooltipScale.length?c?a._tooltipScale[0]:a._tooltipScale[1]:(e+="Â°",a._hoverCallback(a,e),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(e).attr("x",function(){return c?5:-5}).attr("opacity",function(){return Math.max(.2,b/(n/2))}).attr("text-anchor",function(){return c?"start":"end"}))):void 0}).on("mousemove",function(){var b,c,d,e;return a._brush.empty()?(d=d3.mouse(this)[0],d3.select("#"+a._id+"tooltip").attr("transform","translate("+d+", 0)"),c=n/2>=d,b=Math.abs(d-n/2),e=a._xScale.invert(d).toFixed(2),null!=a._tooltipScale&&a._tooltipScale.length?c?a._tooltipScale[0]:a._tooltipScale[1]:(e+="Â°",a._hoverCallback(a,e),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(e).attr("x",function(){return c?5:-5}).attr("opacity",function(){return Math.max(.2,b/(n/2))}).attr("text-anchor",function(){return c?"start":"end"}),d3.select("#"+a._id+"tooltip").style("visibility","visible"))):d3.select("#"+a._id+"tooltip").style("visibility","hidden")}).on("mouseout",function(){return a._unhoverCallback(a),d3.select("#"+a._id+"tooltip").style("visibility","hidden")}),a._brush=d3.svg.brush().x(a._xScale).extent(a._initialBrushExtent).on("brushstart",a._brushed).on("brush",a._brushed).on("brushend",a._brushed),e=f.append("g").attr("class","brush").call(a._brush),e.selectAll("rect").attr("height",m),f.append("clipPath").attr("id","clip-"+a._id).append("rect").attr("width",n).attr("height",m),f.selectAll(".bars").attr("clip-path","url(#clip-"+a._id+")"),k.attr("width",a._width).attr("height",a._height),d=k.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),d.select("g.x_axis").attr("transform","translate(0, "+m+")"),i=d3.svg.area().x(function(b){return a._xScale(b.key)}).y0(function(b){return a._invertedYScale(b[a._verticalParameter]/app.data.all.value())}).y1(function(b){return a._yScale(b[a._verticalParameter]/app.data.all.value())}).interpolate("linear"),h=d.select(".background").selectAll(".backgroundPolygon").data([c]),h.enter().append("path"),h.exit().remove(),h.classed("backgroundPolygon",!0).attr("d",i)})},a.render=function(b){return b.each(function(){var b,c,d,e,f,g,h,i;return b=a._dimension.group(a._group).reduceCount().top(100),b=_.filter(b,function(a){return+a.key!==window.UNKNOWN}),b=_.sortBy(b,function(a){return a.key}),a._precision=b.length,h=a._width-a._margin.left-a._margin.right,g=a._height-a._margin.top-a._margin.bottom-a._axisHeight,a._totalWidth=h,f=d3.select(this).selectAll("svg"),c=f.select("g"),e=d3.svg.area().x(function(b){return a._xScale(b.key)}).y0(function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._invertedYScale(b[a._verticalParameter]/app.data.all.value()):a._invertedYScale(b[a._verticalParameter])}).y1(function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._yScale(b[a._verticalParameter]/app.data.all.value()):a._yScale(b[a._verticalParameter])}).interpolate("linear"),d=c.select(".bars").selectAll(".polygon").data([b]),d.enter().append("path"),d.exit().remove(),d.classed("polygon",!0).attr("d",e),i=d3.svg.axis().scale(a._xScale).ticks(3),f.select(".x_axis").call(i)})},a}(app.views.charts.abstractChart())},app.views.charts.dualRankingBarChart=function(){return function(c){return c._verticalParameter=["y","z"],c._emptyWidth=8,c._emptyHeight=8,c._barChartPadding=.75,c._dataStringFormat='["0,0", "0,0"]',c._dataStringUnit='["", ""]',c._verticalChartPadding=4,c.verticalParameter=function(_){return arguments.length?(c._verticalParameter=eval(_),c):c._verticalParameter
},c.dataStringFormat=function(_){return arguments.length?(c._dataStringFormat=eval(_),c):c._dataStringFormat},c.dataStringUnit=function(_){return arguments.length?(c._dataStringUnit=eval(_),c):c._dataStringUnit},c.verticalChartPadding=function(a){return arguments.length?(c._verticalChartPadding=a,c):c._verticalChartPadding},c.render=function(a){return a.each(function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;return a=c.sortData(a),s=c._verticalParameter[0],b=c._verticalParameter[1],y=Math.round(.25*c._height),n=Math.round(.75*c._height),g=function(a){return-1===a[s]},f=function(a){return-1===a[b]},A=d3.scale.linear().domain([0,d3.max(a,function(a){return a[s]})]).range([c._emptyWidth,c._width-c._margin.left-c._margin.right-c._emptyWidth-2]),v=_.filter(a,function(a){return g(a)}),w=v.length/a.length,u=d3.scale.ordinal().domain(_.map(v,function(a){return a.id})).rangeBands([c._emptyWidth,v.length*(1/c._barChartPadding)*c._emptyWidth-2],c._barChartPadding),p=d3.scale.linear().domain([0,d3.max(a,function(a){return a[b]})]).range([c._emptyWidth,c._width-c._margin.left-c._margin.right-c._emptyWidth-2]),k=_.filter(a,function(a){return f(a)}),l=k.length/a.length,j=d3.scale.ordinal().domain(_.map(k,function(a){return a.id})).rangeBands([c._emptyWidth,k.length*(1/c._barChartPadding)*c._emptyWidth-2],c._barChartPadding),x=function(a){return g(a)?"unavailable":numeral(a[s]).format(c._dataStringFormat[0])+c._dataStringUnit[0]},m=function(a){return f(a)?"unavailable":numeral(a[b]).format(c._dataStringFormat[1])+c._dataStringUnit[1]},z=function(a){return g(a)?Math.round(u(a.id)):Math.round(A(a[s]))},o=function(a){return f(a)?Math.round(j(a.id)):Math.round(p(a[b]))},B=function(){return y},q=function(){return n},r=d3.select(this).selectAll("svg").data([a]),e=r.enter().append("svg").append("g"),e.append("g").attr("class","background"),e.append("g").attr("class","upperBars"),e.append("g").attr("class","lowerBars"),e.append("g").attr("class","connectingLines"),r.attr("width",c._width).attr("height",c._height).classed("dualRankingChart",!0),d=r.select("g").attr("transform","translate("+c._margin.left+","+c._margin.top+")"),e.select(".background").append("line").attr("x1",function(){return c._margin.left}).attr("y1",function(){return y}).attr("x2",function(){return Math.round(c._width-c._margin.left-c._margin.right)}).attr("y2",function(){return y}),e.select(".background").append("line").attr("x1",function(){return c._margin.left}).attr("y1",function(){return n}).attr("x2",function(){return Math.round(c._width-c._margin.left-c._margin.right)}).attr("y2",function(){return n}),t=r.select(".upperBars").selectAll(".bar").data(a),t.enter().append("path"),t.exit().remove(),t.attr("d",function(a){var b,d;return b=z(a),d=B(a),g(a)?(d+=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d+c._emptyHeight)+" Z"):(d-=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d-c._emptyHeight)+" Z")}).attr("title",function(a){return""+a.printName+":<br/>"+x(a)}).attr("class",function(a){var b;return b="bar",a.selected&&(b+=" selectedBar"),g(a)&&(b+=" noDataAvailable"),g(a)||(b+=" dataAvailable"),b+=" "+a.id}).on("mouseover",c._interaction.mouseover).on("mousemove",c._interaction.mousemove).on("mouseout",c._interaction.mouseout).on("click",c._interaction.click).order(),i=r.select(".lowerBars").selectAll(".bar").data(a),i.enter().append("path"),i.exit().remove(),i.attr("d",function(a){var b,d;return b=o(a),d=q(a),f(a)?(d-=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d-c._emptyHeight)+" Z"):(d+=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d+c._emptyHeight)+" Z")}).attr("title",function(a){return""+a.printName+":<br/>"+m(a)}).attr("class",function(a){var b;return b="bar",a.selected&&(b+=" selectedBar"),f(a)&&(b+=" noDataAvailable"),f(a)||(b+=" dataAvailable"),b+=" "+a.id}).on("mouseover",c._interaction.mouseover).on("mousemove",c._interaction.mousemove).on("mouseout",c._interaction.mouseout).on("click",c._interaction.click).order(),h=r.select(".connectingLines").selectAll(".connectingLine").data(a),h.enter().append("line"),h.exit().remove(),h.attr("x1",function(a){return Math.round(z(a)+c._emptyWidth/2)}).attr("y1",function(a){var b;return b=B(a),g(a)?b+=.333*c._emptyHeight+c._verticalChartPadding:b-=.333*c._emptyHeight+c._verticalChartPadding,b=Math.round(b)}).attr("x2",function(a){return Math.round(o(a)+c._emptyWidth/2)}).attr("y2",function(a){var b;return b=q(a),f(a)?b-=.333*c._emptyHeight+c._verticalChartPadding:b+=.333*c._emptyHeight+c._verticalChartPadding,b=Math.round(b)}).attr("class",function(a){var b;return b="connectingLine",a.selected&&(b+=" selectedLine"),b+=" "+a.id}).order()})},c}(app.views.charts.abstractChart())},app.views.charts.dualRankingChart=function(){return function(c){return c._verticalParameter=["y","z"],c._emptyWidth=8,c._emptyHeight=8,c._barChartPadding=.75,c._dataStringFormat='["0,0", "0,0"]',c._dataStringUnit='["", ""]',c._verticalChartPadding=4,c.verticalParameter=function(_){return arguments.length?(c._verticalParameter=eval(_),c):c._verticalParameter},c.dataStringFormat=function(_){return arguments.length?(c._dataStringFormat=eval(_),c):c._dataStringFormat},c.dataStringUnit=function(_){return arguments.length?(c._dataStringUnit=eval(_),c):c._dataStringUnit},c.verticalChartPadding=function(a){return arguments.length?(c._verticalChartPadding=a,c):c._verticalChartPadding},c.render=function(a){return a.each(function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;return a=c.sortData(a),s=c._verticalParameter[0],b=c._verticalParameter[1],y=Math.round(.25*c._height),n=Math.round(.75*c._height),g=function(a){return-1===a[s]},f=function(a){return-1===a[b]},A=d3.scale.linear().domain([0,d3.max(a,function(a){return a[s]})]).range([c._emptyWidth,c._width-c._margin.left-c._margin.right-c._emptyWidth-2]),v=_.filter(a,function(a){return g(a)}),w=v.length/a.length,u=d3.scale.ordinal().domain(_.map(v,function(a){return a.id})).rangeBands([c._emptyWidth,v.length*(1/c._barChartPadding)*c._emptyWidth-2],c._barChartPadding),p=d3.scale.linear().domain([0,d3.max(a,function(a){return a[b]})]).range([c._emptyWidth,c._width-c._margin.left-c._margin.right-c._emptyWidth-2]),k=_.filter(a,function(a){return f(a)}),l=k.length/a.length,j=d3.scale.ordinal().domain(_.map(k,function(a){return a.id})).rangeBands([c._emptyWidth,k.length*(1/c._barChartPadding)*c._emptyWidth-2],c._barChartPadding),x=function(a){return g(a)?"unavailable":numeral(a[s]).format(c._dataStringFormat[0])+c._dataStringUnit[0]},m=function(a){return f(a)?"unavailable":numeral(a[b]).format(c._dataStringFormat[1])+c._dataStringUnit[1]},z=function(a){return g(a)?Math.round(u(a.id)):Math.round(A(a[s]))},o=function(a){return f(a)?Math.round(j(a.id)):Math.round(p(a[b]))},B=function(){return y},q=function(){return n},r=d3.select(this).selectAll("svg").data([a]),e=r.enter().append("svg").append("g"),e.append("g").attr("class","background"),e.append("g").attr("class","upperBars"),e.append("g").attr("class","lowerBars"),e.append("g").attr("class","connectingLines"),r.attr("width",c._width).attr("height",c._height).classed("dualRankingChart",!0),d=r.select("g").attr("transform","translate("+c._margin.left+","+c._margin.top+")"),e.select(".background").append("line").attr("x1",function(){return c._margin.left}).attr("y1",function(){return y}).attr("x2",function(){return Math.round(c._width-c._margin.left-c._margin.right)}).attr("y2",function(){return y}),e.select(".background").append("line").attr("x1",function(){return c._margin.left}).attr("y1",function(){return n}).attr("x2",function(){return Math.round(c._width-c._margin.left-c._margin.right)}).attr("y2",function(){return n}),t=r.select(".upperBars").selectAll(".bar").data(a),t.enter().append("path"),t.exit().remove(),t.attr("d",function(a){var b,d;return b=z(a),d=B(a),g(a)?(d+=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d+c._emptyHeight)+" Z"):(d-=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d-c._emptyHeight)+" Z")}).attr("title",function(a){return""+a.printName+":<br/>"+x(a)}).attr("class",function(a){var b;return b="bar",a.selected&&(b+=" selectedBar"),g(a)&&(b+=" noDataAvailable"),g(a)||(b+=" dataAvailable"),b+=" "+a.id}).on("mouseover",c._interaction.mouseover).on("mousemove",c._interaction.mousemove).on("mouseout",c._interaction.mouseout).on("click",c._interaction.click).order(),i=r.select(".lowerBars").selectAll(".bar").data(a),i.enter().append("path"),i.exit().remove(),i.attr("d",function(a){var b,d;return b=o(a),d=q(a),f(a)?(d-=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d-c._emptyHeight)+" Z"):(d+=c._verticalChartPadding,"M"+b+","+d+" L"+(b+c._emptyWidth)+","+d+" L"+(b+Math.round(c._emptyWidth/2))+","+(d+c._emptyHeight)+" Z")}).attr("title",function(a){return""+a.printName+":<br/>"+m(a)}).attr("class",function(a){var b;return b="bar",a.selected&&(b+=" selectedBar"),f(a)&&(b+=" noDataAvailable"),f(a)||(b+=" dataAvailable"),b+=" "+a.id}).on("mouseover",c._interaction.mouseover).on("mousemove",c._interaction.mousemove).on("mouseout",c._interaction.mouseout).on("click",c._interaction.click).order(),h=r.select(".connectingLines").selectAll(".connectingLine").data(a),h.enter().append("line"),h.exit().remove(),h.attr("x1",function(a){return Math.round(z(a)+c._emptyWidth/2)}).attr("y1",function(a){var b;return b=B(a),g(a)?b+=.333*c._emptyHeight+c._verticalChartPadding:b-=.333*c._emptyHeight+c._verticalChartPadding,b=Math.round(b)}).attr("x2",function(a){return Math.round(o(a)+c._emptyWidth/2)}).attr("y2",function(a){var b;return b=q(a),f(a)?b-=.333*c._emptyHeight+c._verticalChartPadding:b+=.333*c._emptyHeight+c._verticalChartPadding,b=Math.round(b)}).attr("class",function(a){var b;return b="connectingLine",a.selected&&(b+=" selectedLine"),b+=" "+a.id}).order()})},c}(app.views.charts.abstractChart())},app.views.charts.emptyChart=function(){return function(a){return a}(app.views.charts.abstractChart)},MAX_IMAGES=100,app.views.charts.imageGrid=function(){return function(a){var b,c,d,e;return a._barChartPadding=.25,a._id=0,a._axis_width=30,a._brush=void 0,a._dimension=void 0,a._group=function(a){return a},a._brushed=function(){return console.log(a._brush.extent())},a._pathPrefix={},a._currentPathPrefix="",a._picsPerCol=5,a.id=function(b){return arguments.length?(a._id=b,a):a._id},a.dimension=function(b){return arguments.length?(a._dimension=b,a):a._dimension},a.group=function(b){return arguments.length?(a._group=b,a):a._group},a.brush=function(b){return arguments.length?(a._brushed=b,a):a._brush},a.brushed=function(b){return arguments.length?(a._brushed=b,a):a._brushed},a.xScale=function(b){return arguments.length?(a._xScale=b,a):a._xScale},a.yScale=function(b){return arguments.length?(a._yScale=b,a):a._yScale},a.pathPrefix=function(b){return arguments.length?(a._pathPrefix=b,a):a._pathPrefix},a.currentPathPrefix=function(b){return arguments.length?(a._currentPathPrefix=""+b,a):""+a._currentPathPrefix},a.picsPerCol=function(b){return arguments.length?(a._picsPerCol=b,a):a._picsPerCol},a.highlightImages=function(b,c){var d,e,f,g,h;return a.fadeDownImages(),e=[],"bubble"===b.type()?(b.dimension().filter(function(a){return a===c}),e=a._dimension.top(99999999999)):(f=b.xScale().domain()[0],b._orientation&&"vertical"===b._orientation&&(f=b.yScale().domain()[0]),g=b.xScale().domain()[1],b._orientation&&"vertical"===b._orientation&&(g=b.yScale().domain()[1]),h=g-f,b._dimension.filterRange([c-h*(1/b._precision),c+h*(1/b._precision)]),e=a._dimension.top(9999999999)),d=0,d3.selectAll(".selfie").each(function(){var a,b,c,f,g,h,i;for(f=d3.select(this).attr("src"),g=f.split("/"),c=g[g.length-2]+"/"+g[g.length-1],a=!1,h=0,i=e.length;i>h;h++)b=e[h],a=a||c===b.city+"/"+b.id;return a?(d++,d3.select(this).classed("highlight",!0)):void 0})},a.unhighlightImages=function(){return d3.selectAll(".selfie").classed("highlight",!0)},a.fadeDownImages=function(){return d3.selectAll(".selfie").classed("highlight",!1)},a.setup=function(b){return $.fx.speeds._default=300,$(window).resize(function(){return a.render(b)}),a.initImageModeButtons()},a.initImageModeButtons=function(){var b;return b=$(".image-mode button"),b.on("click",function(){return b.removeClass("active"),$(this).addClass("active"),track("selfieMode",$(this).attr("data-image-mode")),a._currentPathPrefix=a._pathPrefix[$(this).attr("data-image-mode")],d3.selectAll(".selfie.page"+a._page).attr("src",function(b){return""+a._currentPathPrefix+b.city+"/"+b.id}),d3.selectAll(".selfie:not(.page"+a._page+")").attr("src",function(b){return""+a._currentPathPrefix+b.city+"/"+b.id})})},e=function(){return 0!==a._page?(a._page--,track("selfiePage",a._page),0===a._page&&d3.select("#previousImagesArrow").style("width","0px").style("height","0px").style("left","0px"),d3.selectAll(".selfieContainer").each(function(){var b;return b=parseInt($(this).css("x")),$(this).transition({x:b+a._w})}),$("#moreImagesArrow").transition({width:a._cellSize/2+"px"})):void 0},c=function(){var b,c,d,e,f,g,h;return b=this.src,c=this.src.split("/"),f=a._pathPrefix.large+c[c.length-2]+"/"+c[c.length-1],track("openSelfie",f),h=$("body").width()/2,e=$("body").height()/2,g="left: "+(h-320)+"px; top: "+(e-320)+"px; width: 640px; height: 640px",d='<div class="selfieContainer"><img src="'+f+'" width="640px" height="640px" class="enlargedImage" style="'+g+'"></img></div>',$("#overlay").append(d),$("#overlay").on("click",function(){return track("closeSelfie",f),$("#copyViewPopup").fadeOut(),$("#overlay").fadeOut(400,function(){return $(this).empty()})}).fadeIn()},b=function(){var b,d,e;return a._data=a._dimension.top(a._maxNumImages*(a._page+1)),a._data=_.sortBy(a._data,function(a){return a.key}),a._furthestPage++,b=function(a,b){return 5*b},e=d3.select(".image-grid").selectAll(".selfieContainer").data(a._data,function(a){return a.city+"/"+a.id}),d=e.enter().append("div").classed("selfieContainer",!0),d.append("img").classed("selfie",!0).classed("highlight",!0).classed("page"+a._page,!0).attr("src",function(b){return""+a._currentPathPrefix+b.city+"/"+b.id}).attr("width",a._cellSize-1+"px").attr("height",a._cellSize-1+"px").attr("margin-left","0px").attr("margin-top","0px").on("click",c),d.each(function(c,d){return $(this).css({x:a._xScale(c,d),y:a._yScale(c,d),scale:0,delay:b(_,d)})}),e.each(function(c,d){return $(this).transition({x:a._xScale(c,d),y:a._yScale(c,d),scale:1,delay:b(_,d)}),$(this).css({width:a._cellSize+"px",height:a._cellSize+"px"})}),e.exit().each(function(c,d){var e=this;return $(this).transition({scale:0,delay:b(_,d)}),_.delay(function(){return e.remove()},b(a._data.length))})},d=function(){return a._page++,track("selfiePage",a._page),a._page<a._maxPages&&a._page===a._furthestPage?b():d3.selectAll(".selfieContainer").each(function(){var b;return b=parseInt($(this).css("x")),$(this).transition({x:b-a._w})}),a._page>=a._maxPages-1?$("#moreImagesArrow").transition({width:"0px"}):$("#moreImagesArrow").transition({width:a._cellSize/2+"px"}),$("#previousImagesArrow").css({left:"0px",height:a._height+"px"}).transition({width:a._cellSize/2+"px"})},a._render=function(b){return b.each(function(){var b,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(a._availableData=a._dimension.top(1e9).length,b=$(window).height()-$(this).offset().top-30,300>b&&(b=300),b>600&&(b=600),$(this).css({height:""+b+"px"}),a._height=b,a._width=$(this).width(),h=75,f=150,g=3200,l=h+Math.pow((g-a._availableData)/g,2)*(f-h),a._picsPerCol=Math.ceil(b/l),a._w=Math.min(a._width,$(this).width()),r=150,i=a._cellSize=Math.floor(a._height/a._picsPerCol),q=a._picsPerCol,p=Math.ceil(a._w/i),a._page=0,o=a._picsPerCol*Math.floor(a._w/i),a._data=a._dimension.top(o),a._data=_.sortBy(a._data,function(a){return a.key}),a._maxPages=Math.ceil(a._availableData/o),a._furthestPage=1,a._data.length<o)for(i=r;!(30>=i);){if(p=Math.floor(a._w/i),t=a._w/p,q=Math.ceil(a._data.length/p),t*q<a._height){i=t;break}i-=1}return a._cellSize=i,a._maxNumImages=o,a._numRows=q,a._numCols=p,a._selfieGridWidth=o/a._numRows*a._cellSize,a._wRemainder=a._w-a._selfieGridWidth,s=i/r,m=d3.select(this).selectAll(".selfieContainer").data(a._data,function(a){return a.city+"/"+a.id}),a._xScale=function(b,c){return Math.floor(c/a._numRows)*a._cellSize-a._page*a._w+a._wRemainder*Math.floor(c/o)},a._yScale=function(b,c){return Math.floor(c%a._numRows)*a._cellSize},j=function(a,b){return 5*b},k=m.enter().append("div").classed("selfieContainer",!0),k.append("img").classed("selfie",!0).classed("highlight",!0).classed("page0",!0).attr("src",function(b){return""+a._currentPathPrefix+b.city+"/"+b.id}).attr("width",a._cellSize-1+"px").attr("height",a._cellSize-1+"px").attr("margin-left","0px").attr("margin-top","0px").on("click",c),n=0,k.each(function(b,c){return $(this).css({x:a._xScale(b,c),y:a._yScale(b,c),scale:0,delay:j(_,c)}),n=c}),m.each(function(b,c){return $(this).transition({x:a._xScale(b,c),y:a._yScale(b,c),scale:1,delay:j(_,c)}),$(this).css({width:i+"px",height:i+"px"})}),d3.select(this).selectAll(".selfie").attr("width",i-1+"px").attr("height",i-1+"px").attr("margin-left","0px").attr("margin-top","0px"),m.exit().each(function(b,c){var d=this;return $(this).transition({scale:0,delay:j(_,c)}),_.delay(function(){return d.remove()},j(a._data.length))}),a._availableData>o?$("#moreImagesArrow").css({right:"0px",height:a._height+"px"}).transition({width:i/2+"px",delay:j(void 0,n)}):d3.select("#moreImagesArrow").style("width","0px").style("height","0px"),d3.select("#previousImagesArrow").style("width","0px").style("height","0px"),d3.select("#moreImagesArrow").on("click",_.throttle(d,500)),d3.select("#previousImagesArrow").on("click",_.throttle(e,500)),a.unhighlightImages()})},a.render=_.throttle(a._render,1e3),a}(app.views.charts.abstractChart())},app.views.charts.invertedRankingBarChart=function(){return function(a){return a._barChartPadding=.4,a.isDataMissing=function(b){return b[a._verticalParameter]<=0},a.render=function(b){return b.each(function(b){var c,d,e,f,g,h,i,j,k,l,m;return e=_.filter(b,function(b){return a.isDataMissing(b)}),f=e.length/b.length,b=a.sortData(b),k=a._width-a._margin.left-a._margin.right,j=a._height-a._margin.top-a._margin.bottom,d=j,e.length>0&&(d=j-a._emptyHeight-8),l=d3.scale.ordinal().domain(b.map(function(a){return a.id})).rangeRoundBands([0,k],a._barChartPadding),m=d3.scale.linear().domain([d3.min(b,function(b){return b[a._verticalParameter]}),d3.max(b,function(b){return b[a._verticalParameter]})]).range([d,0]),i=d3.select(this).selectAll("svg").data([b]),h=i.enter().append("svg").append("g"),h.append("g").attr("class","bars"),h.append("g").attr("class","ornament").attr("transform","translate(0,"+Math.round(a._emptyHeight+4)+")").append("path").attr("d","M "+(l(b[0].id)-1)+" 0 L "+(l(b[b.length-1].id)+a._barChartPadding+Math.round(l.rangeBand())+1)+" 0"),i.attr("width",a._width).attr("height",a._height).classed("rankingBarChart",!0),g=i.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),c=i.select(".bars").selectAll(".bar").data(b),c.enter().append("rect"),c.exit().remove(),c.attr("width",Math.round(l.rangeBand())).attr("x",function(a){return Math.round(l(a.id))}).attr("y",function(b){return a.isDataMissing(b)?0:Math.round(a._emptyHeight+10)}).attr("height",function(b){var c;return a.isDataMissing(b)?a._emptyHeight:(c=Math.round(m.range()[0]-m(b[a._verticalParameter])),c<a._emptyHeight?a._emptyHeight:c)}).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",a._interaction.mouseover).on("mousemove",a._interaction.mousemove).on("mouseout",a._interaction.mouseout).on("click",a._interaction.click).order()})},a}(app.views.charts.abstractChart())},AXIS_HEAD_SPACE_FACTOR=1.1,app.views.charts.polygonChart=function(){return function(a){return a._barChartPadding=.25,a._id=0,a._axisWidth=0,a._axisHeight=10,a._brush=void 0,a._margin.left=0,a._margin.right=0,a._dimension=void 0,a._group=function(a){return a},a._brushed=function(){return console.log(a._brush.extent())},a._verticalParameter="value",a.id=function(b){return arguments.length?(a._id=b,a):a._id},a.dimension=function(b){return arguments.length?(a._dimension=b,a):a._dimension},a.group=function(b){return arguments.length?(a._group=b,a):a._group},a.brush=function(b){return arguments.length?(a._brush=b,a):a._brush},a.brushed=function(b){return arguments.length?(a._brushed=b,a):a._brushed},a.xScale=function(b){return arguments.length?(a._xScale=b,a):a._xScale},a.yScale=function(b){return arguments.length?(a._yScale=b,a):a._yScale},a.type=function(){return"polygon"},a.setup=function(b){return b.each(function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;return c=a._dimension.group(a._group).reduceCount().top(100),c=_.filter(c,function(a){return+a.key!==window.UNKNOWN}),c=_.sortBy(c,function(a){return a.key}),n=a._width-a._margin.left-a._margin.right,m=a._height-a._margin.top-a._margin.bottom+1,g=d3.min(c,function(a){return a.key}),g=0,j=d3.max(c,function(a){return a.key}),null==a._xScale&&(a._xScale=d3.scale.linear().domain([g,j]).rangeRound([-1,n+1])),null==a._yScale&&(a._yScale=d3.scale.linear().domain([0,d3.max(c,function(b){return b[a._verticalParameter]/app.data.faces.size()})]).range([m,a._axisHeight]),a._yScale.domain([0,a._yScale.domain()[1]*AXIS_HEAD_SPACE_FACTOR])),k=d3.select(this).selectAll("svg").data([c]),f=k.enter().append("svg").append("g"),f.append("rect").classed("chart-bg",!0).attr({width:n,height:m}),f.append("g").attr("class","x_axis"),f.append("g").attr("class","bars"),b=f.append("g").attr("class","background"),l=f.append("g").attr("class","tooltip").attr("id",a._id+"tooltip"),l.append("line").classed("tooltipLine",!0).attr("x1",.5).attr("x2",.5).attr("y1",0).attr("y2",m).attr("id",a._id+"tooltip"),l.append("text").classed("tooltipText",!0).attr("text-anchor","end").attr("x",5).attr("y",m/2).text("hello"),d3.select(this).on("mouseover",function(){var b,c,d,e,f,g;return e=d3.mouse(this)[0],d3.select("#"+a._id+"tooltip").attr("transform","translate("+e+", 0)").style("visibility","visible"),d=n/2>=e,c=Math.abs(e-n/2),g=a._xScale.invert(e),f="",b=!0,a._tooltipScale.length&&2===a._tooltipScale.length?f=d?a._tooltipScale[0]:a._tooltipScale[1]:(f=g.toFixed(1),b=!1),a._hoverCallback(a,g),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(f).attr("x",function(){return d?5:-5}).attr("opacity",function(){return b?Math.max(.2,c/(n/2)):1}).attr("text-anchor",function(){return d?"start":"end"})}).on("mousemove",function(){var b,c,d,e,f,g;return e=d3.mouse(this)[0],d3.select("#"+a._id+"tooltip").attr("transform","translate("+e+", 0)"),d=n/2>=e,c=Math.abs(e-n/2),g=a._xScale.invert(e),f="",b=!0,a._tooltipScale.length&&2===a._tooltipScale.length?f=d?a._tooltipScale[0]:a._tooltipScale[1]:(f=g.toFixed(1),b=!1),a._hoverCallback(a,g),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(f).attr("x",function(){return d?5:-5}).attr("opacity",function(){return b?Math.max(.2,c/(n/2)):1}).attr("text-anchor",function(){return d?"start":"end"})}).on("mouseout",function(){return a._unhoverCallback(a),d3.select("#"+a._id+"tooltip").style("visibility","hidden")}),a._brush=d3.svg.brush().x(a._xScale).extent(a._initialBrushExtent).on("brushstart",a._brushed).on("brush",a._brushed).on("brushend",a._brushed),e=f.append("g").attr("class","brush").call(a._brush),e.selectAll("rect").attr("height",m),f.append("clipPath").attr("id","clip-"+a._id).append("rect").attr("width",n).attr("height",m),f.selectAll(".bars").attr("clip-path","url(#clip-"+a._id+")"),k.attr("width",a._width).attr("height",a._height),d=k.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),d.select("g.x_axis").attr("transform","translate(0, "+m+")"),i=d3.svg.area().x(function(b){return a._xScale(b.key)}).y0(m).y1(function(b){return a._yScale(b[a._verticalParameter]/app.data.all.value())}).interpolate("linear"),h=d.select(".background").selectAll(".backgroundPolygon").data([c]),h.enter().append("path"),h.exit().remove(),h.classed("backgroundPolygon",!0).attr("d",i)})},a.render=function(b){return b.each(function(){var b,c,d,e,f,g,h,i;return b=a._dimension.group(a._group).reduceCount().top(100),b=_.filter(b,function(a){return+a.key!==window.UNKNOWN}),b=_.sortBy(b,function(a){return a.key}),a._precision=b.length,h=a._width-a._margin.left-a._margin.right,g=a._height-a._margin.top-a._margin.bottom+1,a._totalWidth=h,f=d3.select(this).selectAll("svg"),c=f.select("g"),e=d3.svg.area().x(function(b){return a._xScale(b.key)}).y0(g).y1(function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._yScale(b[a._verticalParameter]/app.data.all.value()):a._yScale(b[a._verticalParameter])}).interpolate("linear"),d=c.select(".bars").selectAll(".polygon").data([b]),d.enter().append("path"),d.exit().remove(),d.classed("polygon",!0).attr("d",e),i=d3.svg.axis().scale(a._xScale).ticks(3),f.select(".x_axis").call(i)})},a}(app.views.charts.abstractChart())},app.views.charts.rankingBarChart=function(){return function(a){return a._barChartPadding=.4,a.isDataMissing=function(b){return b[a._verticalParameter]<=0},a.render=function(b){return b.each(function(b){var c,d,e,f,g,h,i,j,k,l,m;return e=_.filter(b,function(b){return a.isDataMissing(b)}),f=e.length/b.length,b=a.sortData(b),k=a._width-a._margin.left-a._margin.right,j=a._height-a._margin.top-a._margin.bottom,d=j-5,e.length>0&&(d=j-a._emptyHeight-8),l=d3.scale.ordinal().domain(b.map(function(a){return a.id})).rangeRoundBands([0,k],a._barChartPadding),m=d3.scale.linear().domain([d3.min(b,function(b){return b[a._verticalParameter]}),d3.max(b,function(b){return b[a._verticalParameter]})]).range([d,0]),i=d3.select(this).selectAll("svg").data([b]),h=i.enter().append("svg").append("g"),h.append("g").attr("class","bars"),h.append("g").attr("class","ornament").attr("transform","translate(0,"+Math.round(d+4)+")").append("path").attr("d","M "+(l(b[0].id)-1)+" 0 L "+(l(b[b.length-1].id)+a._barChartPadding+Math.round(l.rangeBand())+1)+" 0"),i.attr("width",a._width).attr("height",a._height).classed("rankingBarChart",!0),g=i.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),c=i.select(".bars").selectAll(".bar").data(b),c.enter().append("rect"),c.exit().remove(),c.attr("width",Math.round(l.rangeBand())).attr("x",function(a){return Math.round(l(a.id))}).attr("y",function(b){var c;return a.isDataMissing(b)?Math.round(j-a._emptyHeight-1):(c=m.range()[0]-m(b[a._verticalParameter]),c<a._emptyHeight?Math.round(d-a._emptyHeight):Math.round(m(b[a._verticalParameter])))}).attr("height",function(b){var c;return a.isDataMissing(b)?a._emptyHeight:(c=Math.round(m.range()[0]-m(b[a._verticalParameter])),c<a._emptyHeight?a._emptyHeight:c)}).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",a._interaction.mouseover).on("mousemove",a._interaction.mousemove).on("mouseout",a._interaction.mouseout).on("click",a._interaction.click).order()})},a}(app.views.charts.abstractChart())},app.views.charts.rankingBlockChart=function(){return function(a){return a._emptyWidth=15,a._emptyHeight=15,a._barChartPadding=2,a._sortingPrefix=-1,a.render=function(b){return b.each(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(b=a.sortData(b),d=function(b){var c;return a.isDataMissing(b)?a._emptyHeight:(c=Math.round(o(Math.sqrt(b[a._verticalParameter]))),c<a._emptyHeight?a._emptyHeight:c)},e=function(b){var c;return a.isDataMissing(b)?a._emptyWidth:(c=Math.round(o(Math.sqrt(b[a._verticalParameter]))),c<a._emptyWidth?a._emptyWidth:c)},j=_.filter(b,function(b){return a.isDataMissing(b)}),k=j.length/b.length,i=j.length*(a._emptyWidth+a._barChartPadding),o=d3.scale.linear().domain([d3.min(b,function(b){return Math.sqrt(b[a._verticalParameter])}),d3.max(b,function(b){return Math.sqrt(b[a._verticalParameter])})]).range([0,1.8*(a._height-a._margin.top-a._margin.bottom)*(1-k)]),q=[],m=[],f=0,g=0,n=1,r=function(b){var c;return c=f,c+=Math.round(n*(e(b)+a._barChartPadding)),1===n?(c>a._width-a._margin.left-a._margin.right&&(g=1,n=-1,c=f-=Math.round(e(b)+a._barChartPadding)),q[b.id]=f):-1===n&&(q[b.id]=c),m[b.id]=g,f=c},s=0,t=b.length;t>s;s++)h=b[s],r(h);return u=a.createSvg(this,b),p=u[0],l=u[1],p.classed("rankingBlockChart",!0),c=p.select(".bars").selectAll(".bar").data(b),c.enter().append("rect"),c.exit().remove(),c.attr("width",e).attr("x",function(a){return Math.round(q[a.id])}).attr("y",function(b){return 0===m[b.id]?0:Math.round(a._height-a._margin.top-a._margin.bottom-d(b)-1)}).attr("height",d).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",a._interaction.mouseover).on("mousemove",a._interaction.mousemove).on("mouseout",a._interaction.mouseout).on("click",a._interaction.click).order()})},a}(app.views.charts.abstractChart())},app.views.charts.rankingPercentageChart=function(){return function(a){return a._barChartPadding=.1,a._topBarHeight=20,a._interChartPadding=3,a.topBarHeight=function(b){return arguments.length?(a._topBarHeight=b,a):a._topBarHeight},a.isDataMissing=function(b){return b[a._verticalParameter]<=0},a.render=function(b){return b.each(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o=this;return b=a.sortData(b),n=d3.scale.linear().domain([0,100]).range([0,a._width-a._margin.left-a._margin.right]),f=_.filter(b,function(b){return a.isDataMissing(b)}),g=f.length/b.length,e=d3.scale.ordinal().domain(_.map(f,function(a){return a.id})).rangeRoundBands([0,(a._width-a._margin.left-a._margin.right)*g],a._barChartPadding),m=d3.select(this).selectAll("svg").data([b]),i=m.enter().append("svg").append("g"),i.append("g").attr("class","backgroundBar"),i.append("g").attr("class","bars"),m.attr("width",a._width).attr("height",a._height).classed("rankingPercentageChart",!0),i.select(".backgroundBar").append("rect").attr("x",0).attr("y",a._margin.top+a._emptyHeight+a._interChartPadding).attr("width",a._width-a._margin.left-a._margin.right).attr("height",a._topBarHeight).attr("class","backgroundBar"),c=m.select(".backgroundBar").selectAll(".bar").data(b),c.enter().append("rect"),c.exit().remove(),c.attr("x",0).attr("y",a._margin.top+a._emptyHeight+a._interChartPadding).attr("width",function(b){return Math.round(n(b[a._verticalParameter]))}).attr("height",a._topBarHeight).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}),k=void 0,l=d3.select(this).select(".label"),l[0][0]||(k=d3.select(this).append("div").classed("label",!0).style("top",-(a._height-a._margin.top-a._margin.bottom+a._emptyHeight)+"px"),j=k.append("h1"),j.append("span").classed("label",!0).text(a._label+" "),j.append("span").classed("value",!0).text("- "+a._dataStringUnit)),h=m.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),d=m.select(".bars").selectAll(".bar").data(b),d.enter().append("rect"),d.exit().remove(),d.attr("width",a._emptyWidth).attr("x",function(b){return a.isDataMissing(b)?Math.round(e(b.id)):Math.round(n(b[a._verticalParameter]))}).attr("y",function(b){return a.isDataMissing(b)?Math.round(a._emptyHeight+2*a._interChartPadding+a._topBarHeight):0
}).attr("height",a._emptyHeight).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",function(b){return a._interaction.mouseover(b),d3.select(o).selectAll(".label span.value").text(a.formatData(b)+" ")}).on("mousemove",a._interaction.mousemove).on("mouseout",function(c){var d;return a._interaction.mouseout(c),d=_.findWhere(b,{selected:"true"}),d3.select(o).selectAll(".label span.value").text(a.formatData(d)+" ")}).on("click",a._interaction.click).order()})},a}(app.views.charts.abstractChart())},app.views.charts.rankingSlitChart=function(){return function(a){return a._barChartPadding=.5,a.render=function(b){return b.each(function(b){var c,d,e,f,g;return b=a.sortData(b),f=d3.scale.ordinal().domain(b.map(function(a){return a.id})).rangeRoundBands([0,a._width-a._margin.left-a._margin.right],a._barChartPadding),g=a.createSvg(this,b),e=g[0],d=g[1],e.classed("rankingSlitChart",!0),c=e.select(".bars").selectAll(".bar").data(b),c.enter().append("rect"),c.exit().remove(),c.attr("width",Math.round(f.rangeBand())).attr("x",function(a){return Math.round(f(a.id))}).attr("y",0).attr("height",Math.round(a._height-a._margin.top-a._margin.bottom-1)).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",a._interaction.mouseover).on("mousemove",a._interaction.mousemove).on("mouseout",a._interaction.mouseout).on("click",a._interaction.click).order()})},a}(app.views.charts.abstractChart())},app.views.charts.rankingTimeline=function(){return function(a){return a._barChartPadding=.1,a.isDataMissing=function(b){return b[a._verticalParameter]<=0},a.render=function(b){return b.each(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return b=a.sortData(b),h=a._width-a._margin.left-a._margin.right-a._emptyWidth-10,g=a._height-a._margin.top-a._margin.bottom,q=a._margin.top+g/2,t=d3.scale.linear().domain([0,d3.max(b,function(b){return b[a._verticalParameter]})]).range([0,h]),i=_.filter(b,function(b){return!a.isDataMissing(b)}),l=_.filter(b,function(b){return a.isDataMissing(b)}),m=l.length/b.length,e=a._emptyWidth+a._barChartPadding,r=Math.floor(h/e),f=d3.layout.histogram().bins(r).value(function(b){return b[a._verticalParameter]})(i),log(f),n=[],_.each(f,function(a){var b;return b=0,_.each(a,function(c){return n.push({x:a.x,y:a.y,dx:a.dx,dy:b,d:c}),b++})}),j=d3.scale.ordinal().domain(_.map(l,function(a){return a.id})).rangeRoundBands([0,h*m],a._barChartPadding),s=d3.select(this).selectAll("svg").data([b]),p=s.enter().append("svg").append("g"),p.append("g").attr("class","bars"),p.append("g").attr("class","arrow").attr("transform","translate(0,"+Math.round(q-5)+")"),p.append("g").attr("class","missingDataBars"),s.attr("width",a._width).attr("height",a._height).classed("rankingTimeline",!0),o=s.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),p.select(".arrow").append("path").attr("d","M"+a._margin.left+",9 L"+Math.round(a._width-a._margin.left-a._margin.right-5)+",9 L"+Math.round(a._width-a._margin.left-a._margin.right-5)+",5 L"+Math.round(a._width-a._margin.left-a._margin.right)+",10 L"+Math.round(a._width-a._margin.left-a._margin.right-5)+",15 L"+Math.round(a._width-a._margin.left-a._margin.right-5)+",11 L"+a._margin.left+",11 Z"),c=s.select(".arrow").selectAll(".bar").data(b),c.enter().append("rect"),c.exit().remove(),c.attr("x",0).attr("y",8).attr("width",function(b){return t(b[a._verticalParameter])}).attr("height",3).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}),d=s.select(".bars").selectAll(".bar").data(n),d.enter().append("rect"),d.exit().remove(),d.attr("width",a._emptyWidth).attr("x",function(a){return t(a.x)}).attr("y",function(a){return q-3-a.dy*e}).attr("height",a._emptyHeight).attr("title",function(b){return""+b.d.printName+":<br/>"+a.formatData(b.d)}).attr("class",function(b){var c;return c="bar",b.d.selected&&(c+=" selectedBar"),a.isDataMissing(b.d)&&(c+=" noDataAvailable"),a.isDataMissing(b.d)||(c+=" dataAvailable"),c+=" "+b.d.id}).on("mouseover",function(b){return a._interaction.mouseover(b.d)}).on("mousemove",function(b){return a._interaction.mousemove(b.d)}).on("mouseout",function(b){return a._interaction.mouseout(b.d)}).on("click",function(b){return a._interaction.click(b.d)}).order(),k=s.select(".missingDataBars").selectAll(".bar").data(l),k.enter().append("rect"),k.exit().remove(),k.attr("x",function(a){return j(a.id)}).attr("y",q+8).attr("width",a._emptyWidth).attr("height",a._emptyHeight).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",function(b){return a._interaction.mouseover(b)}).on("mousemove",function(b){return a._interaction.mousemove(b)}).on("mouseout",function(b){return a._interaction.mouseout(b)}).on("click",function(b){return a._interaction.click(b)}).order()})},a}(app.views.charts.abstractChart())},app.views.charts.rankingTitleChart=function(){return function(a){return a._barChartPadding=2,a._selectedWidth=40,a.selectedWidth=function(b){return arguments.length?(a._emptyHeight=b,a):a._emptyHeight},a.render=function(b){return b.each(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(b=a.sortData(b),d=[],e=(a._width-a._margin.left-a._margin.right-a._selectedWidth-a._barChartPadding)/(b.length-1),e=Math.round(e),e-=a._barChartPadding,g=1,o=function(b){return d[b.id]=g,g+=b.selected?a._selectedWidth+a._barChartPadding:e+a._barChartPadding},p=0,q=b.length;q>p;p++)f=b[p],o(f);return n=function(a){return Math.round(d[a.id])},l=_.filter(b,function(a){return a.selected}),k=function(a){return b.length-b.indexOf(a)},h=function(a){var b;return b=k(a),numeral(b).format("0o")},r=a.createSvg(this,b),m=r[0],i=r[1],m.classed("rankingSlitChart",!0),c=m.select(".bars").selectAll(".bar").data(b),c.enter().append("rect"),c.exit().remove(),c.attr("width",function(b){return b.selected?a._selectedWidth:e}).attr("x",n).attr("y",1).attr("height",a._height-a._margin.top-a._margin.bottom-2).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",a._interaction.mouseover).on("mousemove",a._interaction.mousemove).on("mouseout",a._interaction.mouseout).on("click",a._interaction.click),j=d3.select(this).selectAll(".rankingTitleLabel").data(b.filter(function(a){return a.selected}),function(a){return a.id}),j.enter().append("div"),j.exit().remove(),j.style("margin-top",function(){return"-"+(a._height-a._margin.top-a._margin.bottom+15)+"px"}).style("margin-left",function(a){return""+(n(a)+4)+"px"}).attr("class",function(b){var c;return c="rankingTitleLabel",a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).text(function(a){return h(a)})})},a}(app.views.charts.abstractChart())},AXIS_HEAD_SPACE_FACTOR=1.1,app.views.charts.semiCirclePolygonChart=function(){return function(a){return a._barChartPadding=.25,a._id=0,a._axisWidth=0,a._axisHeight=0,a._brush=void 0,a._margin.left=0,a._margin.right=0,a._dimension=void 0,a._group=function(a){return a},a._brushed=function(){return console.log(a._brush.extent())},a.id=function(b){return arguments.length?(a._id=b,a):a._id},a.dimension=function(b){return arguments.length?(a._dimension=b,a):a._dimension},a.group=function(b){return arguments.length?(a._group=b,a):a._group},a.brush=function(b){return arguments.length?(a._brush=b,a):a._brush},a.brushed=function(b){return arguments.length?(a._brushed=b,a):a._brushed},a.xScale=function(b){return arguments.length?(a._xScale=b,a):a._xScale},a.yScale=function(b){return arguments.length?(a._yScale=b,a):a._yScale},a.setup=function(b){return b.each(function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;return c=a._dimension.group(a._group).reduceCount().top(100),c=_.filter(c,function(a){return+a.key!==window.UNKNOWN}),c=_.sortBy(c,function(a){return a.key}),a._precision=c.length,n=a._width-a._margin.left-a._margin.right,m=a._height-a._margin.top-a._margin.bottom-a._axisHeight,g=d3.min(c,function(a){return a.key}),j=d3.max(c,function(a){return a.key}),null==a._xScale&&(a._angleScale=d3.scale.linear().domain([3*g,3.3*j]).range([-Math.PI,Math.PI]),a._xScale=d3.scale.linear().domain([g,1.1*j]).range([a._margin.left,n])),null==a._yScale&&(a._yScale=d3.scale.sqrt().domain([0,d3.max(c,function(b){return b[a._verticalParameter]/app.data.faces.size()})]).range([0,n/4])),k=d3.select(this).selectAll("svg").data([c]),f=k.enter().append("svg").append("g"),f.append("rect").classed("chart-bg",!0).attr({width:n,height:m}),f.append("g").attr("class","x_axis"),f.append("g").attr("class","bars"),b=f.append("g").attr("class","background"),l=f.append("g").attr("class","tooltip").attr("id",a._id+"tooltip"),l.append("line").classed("tooltipLine",!0).attr("x1",.5).attr("x2",.5).attr("y1",0).attr("y2",m).attr("id",a._id+"tooltip"),l.append("text").classed("tooltipText",!0).attr("text-anchor","end").attr("x",5).attr("y",20).text("hello"),d3.select(this).on("mouseover",function(){var b,c,d,e;return a._brush.empty()?(d=d3.mouse(this)[0],d3.select("#"+a._id+"tooltip").attr("transform","translate("+d+", 0)").style("visibility","visible"),c=n/2>=d,b=Math.abs(d-n/2),e=a._xScale.invert(d).toFixed(2),null!=a._tooltipScale&&a._tooltipScale.length?c?a._tooltipScale[0]:a._tooltipScale[1]:(e+="Â°",a._hoverCallback(a,e),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(e).attr("x",function(){return c?5:-5}).attr("opacity",function(){return Math.max(.2,b/(n/2))}).attr("text-anchor",function(){return c?"start":"end"}))):void 0}).on("mousemove",function(){var b,c,d,e;return a._brush.empty()?(d=d3.mouse(this)[0],d3.select("#"+a._id+"tooltip").attr("transform","translate("+d+", 0)"),c=n/2>=d,b=Math.abs(d-n/2),e=a._xScale.invert(d).toFixed(2),null!=a._tooltipScale&&a._tooltipScale.length?c?a._tooltipScale[0]:a._tooltipScale[1]:(e+="Â°",a._hoverCallback(a,e),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(e).attr("x",function(){return c?5:-5}).attr("opacity",function(){return Math.max(.2,b/(n/2))}).attr("text-anchor",function(){return c?"start":"end"}),d3.select("#"+a._id+"tooltip").style("visibility","visible"))):d3.select("#"+a._id+"tooltip").style("visibility","hidden")}).on("mouseout",function(){return a._unhoverCallback(a),d3.select("#"+a._id+"tooltip").style("visibility","hidden")}),a._brush=d3.svg.brush().x(a._xScale).extent(a._initialBrushExtent).on("brushstart",a._brushed).on("brush",a._brushed).on("brushend",a._brushed),e=f.append("g").attr("class","brush").call(a._brush),e.selectAll("rect").attr("height",m-1),f.append("clipPath").attr("id","clip-"+a._id).append("rect").attr("y",0).attr("x",0).attr("width",n).attr("height",m),f.selectAll(".bars").attr("clip-path","url(#clip-"+a._id+")"),k.attr("width",a._width).attr("height",a._height),d=k.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),d.select("g.x_axis").attr("transform","translate(0, "+m+")"),a._innerRadius=.5*n,i=d3.svg.area.radial().angle(function(b){return a._angleScale(b.key)}).innerRadius(a._innerRadius).outerRadius(function(b){return a._yScale(b[a._verticalParameter]/app.data.all.value())+a._innerRadius}).interpolate("linear"),h=d.select(".background").selectAll(".backgroundPolygon").data([c]),h.enter().append("path"),h.exit().remove(),h.classed("backgroundPolygon",!0).attr("d",i).attr("transform","translate("+n/2+","+.875*n+")")})},a.render=function(b){return b.each(function(){var b,c,d,e,f,g,h,i;return b=a._dimension.group(a._group).reduceCount().top(100),b=_.filter(b,function(a){return+a.key!==window.UNKNOWN}),b=_.sortBy(b,function(a){return a.key}),a._precision=b.length,h=a._width-a._margin.left-a._margin.right,g=a._height-a._margin.top-a._margin.bottom-a._axisHeight,a._totalWidth=h,f=d3.select(this).selectAll("svg"),c=f.select("g"),e=d3.svg.area.radial().angle(function(b){return a._angleScale(b.key)}).innerRadius(a._innerRadius).outerRadius(function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._yScale(b[a._verticalParameter]/app.data.all.value())+a._innerRadius:a._yScale(b[a._verticalParameter])+a._innerRadius}).interpolate("linear"),d=c.select(".bars").selectAll(".polygon").data([b]),d.enter().append("path"),d.exit().remove(),d.classed("polygon",!0).attr("d",e).attr("transform","translate("+h/2+","+.875*h+")"),a._axisHeight>0?(i=d3.svg.axis().scale(a._xScale).ticks(3),f.select(".x_axis").attr("transform",function(){return"translate(0,"+g+")"}).call(i)):void 0})},a}(app.views.charts.abstractChart())},app.views.charts.treemap=function(){return function(a){return a._barChartPadding=1,a._sortingPrefix=-1,a.render=function(b){return b.each(function(b){var c,d,e,f,g,h;return b=a.sortData(b),f={children:b},g=d3.layout.treemap().size([a._width-a._margin.left-a._margin.right,a._height-a._margin.top-a._margin.bottom]).value(function(b){return b[a._verticalParameter]}).padding(0).children(function(a){return a.children}).mode("squarify"),h=a.createSvg(this,b),e=h[0],d=h[1],e.classed("treemap",!0),c=e.select(".bars").datum(f).selectAll(".bar").data(g.nodes),c.enter().append("rect"),c.exit().remove(),c.attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("title",function(b){return""+b.printName+":<br/>"+a.formatData(b)}).attr("class",function(b){var c;return c="bar",b.selected&&(c+=" selectedBar"),a.isDataMissing(b)&&(c+=" noDataAvailable"),a.isDataMissing(b)||(c+=" dataAvailable"),c+=" "+b.id}).on("mouseover",a._interaction.mouseover).on("mousemove",a._interaction.mousemove).on("mouseout",a._interaction.mouseout).on("click",a._interaction.click).order()})},a}(app.views.charts.abstractChart())},AXIS_HEAD_SPACE_FACTOR=1.1,app.views.charts.verticalDualPolygonChart=function(){return function(a){return a._barChartPadding=.25,a._id=0,a._axisWidth=0,a._axisHeight=0,a._brush=void 0,a._margin.left=0,a._margin.right=0,a._margin.top=0,a._margin.bottom=0,a._dimension=void 0,a._group=function(a){return a},a._brushed=function(){return console.log(a._brush.extent())},a._verticalParameter="value",a._orientation="vertical",a.id=function(b){return arguments.length?(a._id=b,a):a._id},a.dimension=function(b){return arguments.length?(a._dimension=b,a):a._dimension},a.group=function(b){return arguments.length?(a._group=b,a):a._group},a.brush=function(b){return arguments.length?(a._brush=b,a):a._brush},a.brushed=function(b){return arguments.length?(a._brushed=b,a):a._brushed},a.xScale=function(b){return arguments.length?(a._xScale=b,a):a._xScale},a.yScale=function(b){return arguments.length?(a._yScale=b,a):a._yScale},a.type=function(){return"verticaldualpolygon"},a.setup=function(b){return b.each(function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;return c=a._dimension.group(a._group).reduceCount().top(100),c=_.filter(c,function(a){return+a.key!==window.UNKNOWN}),c=_.sortBy(c,function(a){return a.key}),n=a._width-a._margin.left-a._margin.right,m=a._height-a._margin.top-a._margin.bottom,null==a._yScale&&(g=d3.min(c,function(a){return a.key}),j=d3.max(c,function(a){return a.key}),a._yScale=d3.scale.linear().domain([g,j]).rangeRound([m,0])),null==a._xScale&&(a._xScale=d3.scale.sqrt().domain([0,d3.max(c,function(b){return AXIS_HEAD_SPACE_FACTOR*b[a._verticalParameter]/app.data.faces.size()})]).range([n/2,n]),a._invertedXScale=d3.scale.sqrt().domain([0,d3.max(c,function(b){return AXIS_HEAD_SPACE_FACTOR*b[a._verticalParameter]/app.data.faces.size()})]).range([n/2,0])),k=d3.select(this).selectAll("svg").data([c]),f=k.enter().append("svg").append("g"),f.append("rect").classed("chart-bg",!0).attr({width:n,height:m}),f.append("g").attr("class","bars"),b=f.append("g").attr("class","background"),f.append("g").attr("class","y_axis"),f.append("g").attr("class","separator").append("line").classed("separatorLine",!0).attr("x1",n/2).attr("y1",0).attr("x2",n/2).attr("y2",m),l=f.append("g").attr("class","tooltip").attr("id",a._id+"tooltip"),l.append("line").classed("tooltipLine",!0).attr("x1",0).attr("x2",n).attr("y1",0).attr("y2",0).attr("id",a._id+"tooltip"),l.append("text").classed("tooltipText",!0).attr("text-anchor","start").attr("x",5.5).attr("y",-5).text("hello"),d3.select(this).on("mouseover",function(){var b,c,d,e;return a._brush.empty()?(c=d3.mouse(this)[1],d3.select("#"+a._id+"tooltip").attr("transform","translate(0, "+c+")").style("visibility","visible"),d=m/2>=c,b=Math.abs(c-m/2),e=a._yScale.invert(c),a._hoverCallback(a,e),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(function(){return d?a._tooltipScale[0]:a._tooltipScale[1]}).attr("opacity",function(){return Math.max(.2,b/(m/2))}).attr("y",function(){return d?15:-5})):void 0}).on("mousemove",function(){var b,c,d,e;return a._brush.empty()?(c=d3.mouse(this)[1],d3.select("#"+a._id+"tooltip").attr("transform","translate(0, "+c+")"),d=m/2>=c,b=Math.abs(c-m/2),e=a._yScale.invert(c),a._hoverCallback(a,e),d3.select("#"+a._id+"tooltip").select(".tooltipText").text(function(){return d?a._tooltipScale[0]:a._tooltipScale[1]}).attr("opacity",function(){return Math.max(.2,b/(m/2))}).attr("y",function(){return d?15:-5}),d3.select("#"+a._id+"tooltip").style("visibility","visible")):d3.select("#"+a._id+"tooltip").style("visibility","hidden")}).on("mouseout",function(){return a._unhoverCallback(a),d3.select("#"+a._id+"tooltip").style("visibility","hidden")}),a._brush=d3.svg.brush().y(a._yScale).extent(a._initialBrushExtent).on("brushstart",a._brushed).on("brush",a._brushed).on("brushend",a._brushed),e=f.append("g").attr("class","brush").call(a._brush),e.selectAll("rect").attr("width",n),f.append("clipPath").attr("id","clip-"+a._id).append("rect").attr("width",n).attr("height",m),f.selectAll(".bars").attr("clip-path","url(#clip-"+a._id+")"),k.attr("width",a._width).attr("height",a._height),d=k.select("g").attr("transform","translate("+a._margin.left+","+a._margin.top+")"),d.select("g.y_axis").attr("transform","translate(25, 0)"),i=d3.svg.area().x(function(b){return a._yScale(b.key)}).y0(function(b){return a._xScale(b[a._verticalParameter]/app.data.all.value())}).y1(function(b){return a._invertedXScale(b[a._verticalParameter]/app.data.all.value())}).interpolate("linear"),h=d.select(".background").selectAll(".backgroundPolygon").data([c]),h.enter().append("path"),h.exit().remove(),h.classed("backgroundPolygon",!0).attr("transform","rotate(90) translate(0,-"+n+")").attr("d",i)})},a.render=function(b){return b.each(function(){var b,c,d,e,f,g,h,i;return b=a._dimension.group(a._group).reduceCount().top(100),b=_.filter(b,function(a){return+a.key!==window.UNKNOWN}),b=_.sortBy(b,function(a){return a.key}),a._precision=b.length,h=a._width-a._margin.left-a._margin.right,g=a._height-a._margin.top-a._margin.bottom,a._totalHeight=g,f=d3.select(this).selectAll("svg"),c=f.select("g"),e=d3.svg.area().x(function(b){return a._yScale(b.key)}).y0(function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._xScale(b[a._verticalParameter]/app.data.all.value()):a._xScale(b[a._verticalParameter])}).y1(function(b){return null!=app.data.all.value()&&0!==app.data.all.value()?a._invertedXScale(b[a._verticalParameter]/app.data.all.value()):a._invertedXScale(b[a._verticalParameter])}).interpolate("linear"),d=c.select(".bars").selectAll(".polygon").data([b]),d.enter().append("path"),d.exit().remove(),d.classed("polygon",!0).attr("transform","rotate(90) translate(0,-"+h+")").attr("d",e),a._axisWidth>0?(i=d3.svg.axis().scale(a._yScale).ticks(5).orient("left"),f.select(".y_axis").call(i)):void 0})},a}(app.views.charts.abstractChart())}}.call(this);
